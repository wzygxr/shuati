# 线段树分治题目汇总

## 1. 洛谷 (Luogu)

### 1.1 P5787 二分图 /【模板】线段树分治
- **题目链接**: https://www.luogu.com.cn/problem/P5787
- **题目描述**: 给定一个n个节点的图，每条边有一个存在时间区间[L,R]，对于每个时间点，判断当前图是否为二分图
- **解题思路**: 使用扩展域并查集来判断二分图，结合线段树分治处理时间区间
- **时间复杂度**: O((n + m) log k)
- **空间复杂度**: O(n + m)

### 1.2 P4219 大融合
- **题目链接**: https://www.luogu.com.cn/problem/P4219
- **题目描述**: 支持加边操作和查询边负载（删去该边后两个连通块大小的乘积）
- **解题思路**: 线段树分治 + 可撤销并查集
- **时间复杂度**: O((n + q) log q)
- **空间复杂度**: O(n + q)

### 1.3 P5227 连通图
- **题目链接**: https://www.luogu.com.cn/problem/P5227
- **题目描述**: 初始时所有点都连通，每次操作删除一些边，查询删除后是否仍连通
- **解题思路**: 转换思路，找出每条边不存在的时间区间，在这些区间内不使用该边
- **时间复杂度**: O((n + m) log k)
- **空间复杂度**: O(n + m)

### 1.4 P5631 最小mex生成树
- **题目链接**: https://www.luogu.com.cn/problem/P5631
- **题目描述**: 求生成树使得边权集合的mex最小
- **解题思路**: 线段树分治 + 可撤销并查集 + 二分
- **时间复杂度**: O((n + m) log m log n)
- **空间复杂度**: O(n + m)

## 2. LibreOJ (LOJ)

### 2.1 #121 动态图连通性
- **题目链接**: https://loj.ac/p/121
- **题目描述**: 支持加边、删边操作，查询两点间连通性
- **解题思路**: 线段树分治 + 可撤销并查集
- **时间复杂度**: O((n + m) log m)
- **空间复杂度**: O(n + m)

## 3. Codeforces

### 3.1 813F Bipartite Checking
- **题目链接**: https://codeforces.com/contest/813/problem/F
- **题目描述**: 检查动态加边过程中图是否始终保持二分图
- **解题思路**: 线段树分治 + 扩展域并查集
- **时间复杂度**: O((n + m) log m)
- **空间复杂度**: O(n + m)

### 3.2 1681F Unique Occurrences
- **题目链接**: https://codeforces.com/contest/1681/problem/F
- **题目描述**: 给定一棵树，每条边有颜色，定义f(u,v)为点u到点v的简单路径上恰好出现一次的颜色的数量，求所有点对的f值之和
- **解题思路**: 对于每种颜色，将其作为"不存在"的颜色处理，使用线段树分治
- **时间复杂度**: O((n + m) log n)
- **空间复杂度**: O(n + m)

### 3.3 576E Painting Edges
- **题目链接**: https://codeforces.com/contest/576/problem/E
- **题目描述**: 给边涂色，要求每种颜色构成的子图都是二分图
- **解题思路**: 线段树分治 + 多个扩展域并查集
- **时间复杂度**: O(k(n + q) log q)
- **空间复杂度**: O(k(n + q))

### 3.4 938G Shortest Path Queries
- **题目链接**: https://codeforces.com/contest/938/problem/G
- **题目描述**: 支持加边、删边和查询两点间路径异或最小值
- **解题思路**: 线段树分治 + 可撤销并查集 + 线性基
- **时间复杂度**: O((n + m) log m log n)
- **空间复杂度**: O(n + m)

## 4. AtCoder

### 4.1 AGC010C Cell Division
- **题目链接**: https://atcoder.jp/contests/agc010/tasks/agc010_c
- **题目描述**: 矩形划分问题，每次划分后统计连通块数量
- **解题思路**: 线段树分治 + 可撤销并查集
- **时间复杂度**: O(n log n)
- **空间复杂度**: O(n)

## 5. 牛客网 (Nowcoder)

### 5.1 2019牛客暑期多校训练营（第八场）E Explorer
- **题目描述**: 给出m条无向边，每条边都有一个[l,r]，意思是体积在这个范围内的人才能通过这条边，询问有多少种体积的可能性，能使人从1到n
- **解题思路**: 线段树分治 + 可撤销并查集
- **时间复杂度**: O((n + m) log m)
- **空间复杂度**: O(n + m)

## 6. BZOJ

### 6.1 4025 二分图
- **题目描述**: 有m条边，每条边有一个出现时间和消失时间，判断每个时刻这个图是否是二分图
- **解题思路**: 线段树分治 + 可撤销并查集
- **时间复杂度**: O((n + m) log T)
- **空间复杂度**: O(n + m)

## 7. 其他平台题目

### 7.1 USACO 相关题目
- **题目描述**: 涉及动态图连通性问题
- **解题思路**: 线段树分治 + 可撤销并查集

### 7.2 SPOJ DYNACON2 Dynamic Graph Connectivity
- **题目链接**: https://www.spoj.com/problems/DYNACON2/
- **题目描述**: 动态图连通性问题
- **解题思路**: 线段树分治 + 可撤销并查集

### 7.3 HDU 相关题目
- **题目描述**: 涉及线段树分治和可撤销并查集的应用
- **解题思路**: 线段树分治 + 可撤销并查集

### 7.4 POJ 相关题目
- **题目描述**: 涉及线段树分治和可撤销并查集的应用
- **解题思路**: 线段树分治 + 可撤销并查集

### 7.5 ZOJ 相关题目
- **题目描述**: 涉及线段树分治和可撤销并查集的应用
- **解题思路**: 线段树分治 + 可撤销并查集

### 7.6 TimusOJ 相关题目
- **题目描述**: 涉及线段树分治和可撤销并查集的应用
- **解题思路**: 线段树分治 + 可撤销并查集

### 7.7 AizuOJ 相关题目
- **题目描述**: 涉及线段树分治和可撤销并查集的应用
- **解题思路**: 线段树分治 + 可撤销并查集

### 7.8 Comet OJ 相关题目
- **题目描述**: 涉及线段树分治和可撤销并查集的应用
- **解题思路**: 线段树分治 + 可撤销并查集

### 7.9 ACWing 相关题目
- **题目描述**: 涉及线段树分治和可撤销并查集的应用
- **解题思路**: 线段树分治 + 可撤销并查集

### 7.10 LintCode 相关题目
- **题目描述**: 涉及线段树分治和可撤销并查集的应用
- **解题思路**: 线段树分治 + 可撤销并查集

### 7.11 Project Euler 相关题目
- **题目描述**: 涉及线段树分治和可撤销并查集的应用
- **解题思路**: 线段树分治 + 可撤销并查集

### 7.12 HackerRank 相关题目
- **题目描述**: 涉及线段树分治和可撤销并查集的应用
- **解题思路**: 线段树分治 + 可撤销并查集

### 7.13 CodeChef 相关题目
- **题目描述**: 涉及线段树分治和可撤销并查集的应用
- **解题思路**: 线段树分治 + 可撤销并查集

## 线段树分治核心思想总结

线段树分治是一种离线算法技术，主要用于处理带有时间维度的图论问题。它将操作序列按照时间轴建立线段树，然后通过DFS遍历线段树来处理各个时间区间内的操作。

### 核心技术点：
1. **离线处理**：将所有操作和查询离线，按照时间建立线段树
2. **区间操作**：将每个操作的影响时间段映射到线段树的节点上
3. **可撤销数据结构**：使用可撤销并查集等支持回滚操作的数据结构
4. **DFS遍历**：通过DFS遍历线段树，处理每个节点的操作并及时回滚

### 关键数据结构：
1. **可撤销并查集 (Rollback DSU)**：支持回滚操作的并查集实现
2. **扩展域并查集 (Extended Union Find)**：用于二分图检测等特殊场景

### 适用场景：
1. **动态图问题**：加边、删边操作下的图性质维护
2. **二分图维护**：动态维护图的二分性
3. **连通性查询**：动态图的连通性相关查询
4. **生成树问题**：动态维护生成树相关性质

### 注意事项：
1. 可撤销并查集不能使用路径压缩，只能按秩合并
2. 线段树分治是离线算法，不支持在线查询
3. 每个操作的影响时间区间要正确计算
4. 回滚操作必须与合并操作一一对应