# N皇后问题详解

## 概述

N皇后问题是一个经典的回溯算法问题，研究的是如何将 n 个皇后放置在 n×n 的棋盘上，并且使皇后彼此之间不能相互攻击。

按照国际象棋的规则，皇后可以攻击与之处在同一行或同一列或同一斜线上的棋子。

## 核心知识点

### 1. 问题分析

在N皇后问题中，需要满足以下约束条件：
1. 任意两个皇后不能在同一行
2. 任意两个皇后不能在同一列
3. 任意两个皇后不能在同一条对角线上

### 2. 解法思路

#### 方法一：基于数组的回溯实现
- 使用一个数组path记录每行皇后所在的列位置
- 通过递归逐行尝试放置皇后
- 对每个位置检查是否与之前放置的皇后冲突

#### 方法二：基于位运算的优化实现（推荐）
- 使用位运算表示皇后的位置和约束条件
- 通过位运算快速判断可放置位置
- 效率远高于方法一

### 3. 约束条件判断

对于位置(i,j)和之前放置的皇后(k, path[k])，冲突条件为：
1. 同列：j == path[k]
2. 同对角线：abs(i-k) == abs(j-path[k])

使用位运算时：
- 列约束：用一个整数的二进制位表示各列是否被占用
- 对角线约束：用两个整数分别表示两个方向的对角线是否被占用

## 算法复杂度分析

### 时间复杂度
- 两种方法均为 O(N!)，因为对于第1个皇后有N种选择，第2个有N-1种选择，以此类推

### 空间复杂度
- 递归栈深度为N，所以空间复杂度为 O(N)

## 工程化考虑

### 异常处理
- 输入校验：检查n是否为正整数
- 边界条件：n=1时的特殊处理

### 性能优化
- 位运算优化：方法二通过位运算大幅提升性能
- 剪枝优化：及时发现冲突并回溯

### 代码可读性
- 函数命名清晰
- 添加详细注释
- 模块化设计

## 相关题目（扩展版）

### 基础N皇后问题

#### 1. LeetCode 51. N皇后
- **平台**：LeetCode
- **题目**：返回所有不同的N皇后问题解决方案
- **链接**：https://leetcode.cn/problems/n-queens/
- **难度**：困难
- **解法**：回溯算法，构造所有解的棋盘表示
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 2. LeetCode 52. N皇后 II
- **平台**：LeetCode
- **题目**：返回N皇后问题不同解决方案的数量
- **链接**：https://leetcode.cn/problems/n-queens-ii/
- **难度**：困难
- **解法**：回溯算法，仅计数
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 3. 牛客网 N皇后问题
- **平台**：牛客网
- **题目**：N皇后问题的解法数
- **链接**：https://www.nowcoder.com/practice/c76408782512486d91eea181107293b6
- **难度**：中等
- **解法**：与LeetCode 52相同
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 4. 剑指Offer 38. 字符串的排列（类似思想）
- **平台**：剑指Offer
- **题目**：字符串的全排列问题，与N皇后回溯思想相似
- **链接**：https://leetcode.cn/problems/zi-fu-chuan-de-pai-lie-lcof/
- **难度**：中等
- **解法**：回溯算法
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 5. 面试题08.12. 八皇后（LeetCode）
- **平台**：LeetCode
- **题目**：设计一种算法，打印N皇后在N × N棋盘上的各种摆法
- **链接**：https://leetcode.cn/problems/eight-queens-lcci/
- **难度**：困难
- **解法**：回溯算法
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

### 变种问题

#### 6. HackerRank Queen's Attack II
- **平台**：HackerRank
- **题目**：在一个有障碍物的棋盘上，计算皇后能攻击的格子数
- **链接**：https://www.hackerrank.com/challenges/queens-attack-2/problem
- **难度**：中等
- **解法**：计算皇后在8个方向上能攻击的格子数，考虑障碍物阻挡
- **时间复杂度**：O(k)，k为障碍物数量
- **空间复杂度**：O(k)

#### 7. POJ 1321 棋盘问题
- **平台**：POJ (北京大学在线评测系统)
- **题目**：在给定形状的棋盘上摆放k个棋子，要求任意两个棋子不能在同一行或同一列
- **链接**：http://poj.org/problem?id=1321
- **难度**：简单
- **解法**：N皇后问题的变种，在不规则棋盘上放置棋子
- **时间复杂度**：O(2^n)
- **空间复杂度**：O(n)

#### 8. 杭电OJ 2553 N皇后问题
- **平台**：杭州电子科技大学OJ
- **题目**：标准的N皇后问题计数
- **链接**：http://acm.hdu.edu.cn/showproblem.php?pid=2553
- **难度**：中等
- **解法**：回溯算法
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 9. Aizu ALDS1_13_A 8 Queens Problem
- **平台**：Aizu Online Judge
- **题目**：8皇后问题，部分皇后位置已确定
- **链接**：https://onlinejudge.u-aizu.ac.jp/courses/lesson/1/ALDS1/all/ALDS1_13_A
- **难度**：中等
- **解法**：在部分皇后位置已知的情况下，完成剩余皇后的放置
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 10. UVa OJ 11195 - Another n-Queen Problem
- **平台**：UVa Online Judge
- **题目**：有障碍物的N皇后问题
- **链接**：https://onlinejudge.org/index.php?option=com_onlinejudge&Itemid=8&page=show_problem&problem=2136
- **难度**：困难
- **解法**：回溯算法+位运算优化
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 11. CodeChef N Queens Puzzle
- **平台**：CodeChef
- **题目**：N皇后问题的变种，要求输出具体解
- **链接**：https://www.codechef.com/problems/NQUEENS
- **难度**：中等
- **解法**：回溯算法
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 12. SPOJ NQUEEN
- **平台**：SPOJ
- **题目**：高效的N皇后问题求解
- **链接**：https://www.spoj.com/problems/NQUEEN/
- **难度**：困难
- **解法**：位运算优化的回溯算法
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 13. 洛谷 P1219 八皇后
- **平台**：洛谷
- **题目**：经典的八皇后问题
- **链接**：https://www.luogu.com.cn/problem/P1219
- **难度**：普及/提高-
- **解法**：回溯算法
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 14. 计蒜客 八皇后问题
- **平台**：计蒜客
- **题目**：八皇后问题的求解
- **链接**：https://www.jisuanke.com/course/1/1001
- **难度**：中等
- **解法**：回溯算法
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 15. USACO 1.5.4 Checker Challenge
- **平台**：USACO
- **题目**：N皇后问题的挑战版本
- **链接**：http://www.usaco.org/index.php?page=viewproblem2&cpid=1114
- **难度**：中等
- **解法**：回溯算法+优化
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 16. AtCoder ABC 215 C - One More aab aba baa
- **平台**：AtCoder
- **题目**：排列组合问题，与N皇后回溯思想相似
- **链接**：https://atcoder.jp/contests/abc215/tasks/abc215_c
- **难度**：中等
- **解法**：回溯算法生成排列
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 17. Project Euler Problem 315 - Digital root clocks
- **平台**：Project Euler
- **题目**：数字根时钟问题，涉及排列组合
- **链接**：https://projecteuler.net/problem=315
- **难度**：困难
- **解法**：组合数学+回溯思想
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 18. HackerEarth N-Queens Problem
- **平台**：HackerEarth
- **题目**：N皇后问题的标准实现
- **链接**：https://www.hackerearth.com/practice/basic-programming/recursion/recursion-and-backtracking/practice-problems/algorithm/n-queensrecursion-trackback-hacking/
- **难度**：中等
- **解法**：回溯算法
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 19. Timus OJ 1028. Stars
- **平台**：Timus Online Judge
- **题目**：星星计数问题，涉及二维空间搜索
- **链接**：http://acm.timus.ru/problem.aspx?space=1&num=1028
- **难度**：中等
- **解法**：树状数组/线段树，与N皇后的空间搜索思想相关
- **时间复杂度**：O(N log N)
- **空间复杂度**：O(N)

#### 20. Codeforces 4D - Mysterious Present
- **平台**：Codeforces
- **题目**：神秘礼物问题，涉及二维排序和搜索
- **链接**：https://codeforces.com/problemset/problem/4/D
- **难度**：中等
- **解法**：动态规划+排序
- **时间复杂度**：O(N²)
- **空间复杂度**：O(N)

#### 21. ZOJ 1002 - Fire Net
- **平台**：ZOJ
- **题目**：火力网问题，类似N皇后但在网格中放置炮台
- **链接**：http://acm.zju.edu.cn/onlinejudge/showProblem.do?problemCode=1002
- **难度**：简单
- **解法**：回溯算法
- **时间复杂度**：O(2^(n²))
- **空间复杂度**：O(n²)

### 高级变种问题

#### 22. 多皇后问题 (k-Queens)
- **平台**：各大OJ常见变种
- **题目**：在n×n棋盘上放置k个皇后，使得它们互不攻击
- **难度**：中等
- **解法**：回溯算法，但只需放置k个皇后
- **时间复杂度**：O(C(n², k))
- **空间复杂度**：O(n)

#### 23. 有障碍物的N皇后问题
- **平台**：面试常见变种
- **题目**：某些格子不能放置皇后
- **难度**：困难
- **解法**：回溯算法+障碍物检查
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 24. 双皇后问题
- **平台**：组合数学问题
- **题目**：计算两个皇后互不攻击的位置组合数
- **难度**：简单
- **解法**：枚举+数学计算
- **时间复杂度**：O(N²)
- **空间复杂度**：O(1)

#### 25. 皇后覆盖问题
- **平台**：组合优化问题
- **题目**：检查k个皇后是否能覆盖整个棋盘
- **难度**：困难
- **解法**：回溯算法+覆盖检查
- **时间复杂度**：O(N^k)
- **空间复杂度**：O(N)

#### 26. 非递归N皇后解法
- **平台**：算法教学变种
- **题目**：使用迭代而非递归解决N皇后问题
- **难度**：中等
- **解法**：使用栈模拟递归过程
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

#### 27. 位运算优化的N皇后解法
- **平台**：高效算法实现
- **题目**：使用位运算大幅提升N皇后问题求解效率
- **难度**：困难
- **解法**：位运算表示约束条件
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

## 更多相关题目

### 28. LeetCode 37. 解数独
- **平台**：LeetCode
- **题目**：编写一个程序，通过已填充的空格来解决数独问题
- **链接**：https://leetcode.cn/problems/sudoku-solver/
- **难度**：困难
- **解法**：回溯算法，与N皇后问题思想类似
- **时间复杂度**：O(9^(n²))
- **空间复杂度**：O(n²)

### 29. LeetCode 46. 全排列
- **平台**：LeetCode
- **题目**：给定一个没有重复数字的序列，返回其所有可能的全排列
- **链接**：https://leetcode.cn/problems/permutations/
- **难度**：中等
- **解法**：回溯算法，与N皇后问题的回溯思想一致
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

### 30. LeetCode 47. 全排列 II
- **平台**：LeetCode
- **题目**：给定一个可包含重复数字的序列，返回所有不重复的全排列
- **链接**：https://leetcode.cn/problems/permutations-ii/
- **难度**：中等
- **解法**：回溯算法+去重处理
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

### 31. LeetCode 79. 单词搜索
- **平台**：LeetCode
- **题目**：给定一个二维网格和一个单词，判断该单词是否存在于网格中
- **链接**：https://leetcode.cn/problems/word-search/
- **难度**：中等
- **解法**：回溯算法+深度优先搜索
- **时间复杂度**：O(M×N×4^L)，其中M和N是网格的行数和列数，L是单词长度
- **空间复杂度**：O(L)

### 32. LeetCode 212. 单词搜索 II
- **平台**：LeetCode
- **题目**：给定一个二维网格和一个单词列表，找出网格中存在的所有单词
- **链接**：https://leetcode.cn/problems/word-search-ii/
- **难度**：困难
- **解法**：回溯算法+字典树(Trie)
- **时间复杂度**：O(M×N×4^L)，其中M和N是网格的行数和列数，L是最长单词的长度
- **空间复杂度**：O(K×L)，其中K是单词数量，L是最长单词的长度

### 33. LeetCode 354. 俄罗斯套娃信封问题
- **平台**：LeetCode
- **题目**：给定一些标记了宽度和高度的信封，当另一个信封的宽度和高度都比这个信封大的时候，这个信封就可以放进另一个信封里
- **链接**：https://leetcode.cn/problems/russian-doll-envelopes/
- **难度**：困难
- **解法**：排序+最长递增子序列(LIS)
- **时间复杂度**：O(N log N)
- **空间复杂度**：O(N)

### 34. LeetCode 300. 最长递增子序列
- **平台**：LeetCode
- **题目**：给定一个无序的整数数组，找到其中最长上升子序列的长度
- **链接**：https://leetcode.cn/problems/longest-increasing-subsequence/
- **难度**：中等
- **解法**：动态规划/二分查找
- **时间复杂度**：O(N²)或O(N log N)
- **空间复杂度**：O(N)

### 35. LeetCode 491. 递增子序列
- **平台**：LeetCode
- **题目**：给定一个整型数组，找到所有该数组的递增子序列
- **链接**：https://leetcode.cn/problems/increasing-subsequences/
- **难度**：中等
- **解法**：回溯算法+去重处理
- **时间复杂度**：O(2^N)
- **空间复杂度**：O(N)

### 36. LeetCode 40. 组合总和 II
- **平台**：LeetCode
- **题目**：给定一个数组 candidates 和一个目标数 target，找出 candidates 中所有可以使数字和为 target 的组合
- **链接**：https://leetcode.cn/problems/combination-sum-ii/
- **难度**：中等
- **解法**：回溯算法+剪枝
- **时间复杂度**：O(2^N)
- **空间复杂度**：O(N)

### 37. LeetCode 90. 子集 II
- **平台**：LeetCode
- **题目**：给定一个可能包含重复元素的整数数组，返回该数组所有可能的子集（幂集）
- **链接**：https://leetcode.cn/problems/subsets-ii/
- **难度**：中等
- **解法**：回溯算法+去重处理
- **时间复杂度**：O(2^N)
- **空间复杂度**：O(N)

### 38. LeetCode 473. 火柴拼正方形
- **平台**：LeetCode
- **题目**：给定一个整数数组 matchsticks，其中 matchsticks[i] 是第 i 个火柴棒的长度
- **链接**：https://leetcode.cn/problems/matchsticks-to-square/
- **难度**：中等
- **解法**：回溯算法+剪枝优化
- **时间复杂度**：O(4^N)
- **空间复杂度**：O(N)

### 39. LeetCode 698. 划分为k个相等的子集
- **平台**：LeetCode
- **题目**：给定一个整数数组 nums 和一个正整数 k，找出是否有可能把这个数组分成 k 个非空子集，其总和都相等
- **链接**：https://leetcode.cn/problems/partition-to-k-equal-sum-subsets/
- **难度**：中等
- **解法**：回溯算法+剪枝优化
- **时间复杂度**：O(k^N)
- **空间复杂度**：O(N)

### 40. POJ 1016 N皇后问题扩展
- **平台**：POJ
- **题目**：N皇后问题的变形，要求皇后不能攻击到特定位置
- **链接**：http://poj.org/problem?id=1016
- **难度**：困难
- **解法**：回溯算法+约束条件处理
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

### 41. HDU 2553 N皇后问题（经典版本）
- **平台**：杭电OJ
- **题目**：经典的N皇后问题计数
- **链接**：http://acm.hdu.edu.cn/showproblem.php?pid=2553
- **难度**：中等
- **解法**：回溯算法+预处理优化
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

### 42. ZOJ 1403 N皇后问题变种
- **平台**：ZOJ
- **题目**：N皇后问题的扩展版本，增加了额外约束条件
- **链接**：http://acm.zju.edu.cn/onlinejudge/showProblem.do?problemCode=1403
- **难度**：困难
- **解法**：回溯算法+复杂约束处理
- **时间复杂度**：O(N!)
- **空间复杂度**：O(N)

## 适用场景

1. **算法学习**：经典的回溯算法教学案例
2. **面试考察**：常考的递归和回溯问题
3. **组合优化**：搜索满足约束条件的所有组合
4. **游戏AI**：棋类游戏中的布局问题

## 面试重点

1. 理解皇后之间的约束关系
2. 掌握回溯算法的基本思想
3. 能够分析时间和空间复杂度
4. 熟悉位运算优化技巧
5. 能够进行代码优化和边界处理

## 扩展问题

1. **N皇后计数**：仅需返回解的数量而非具体解
2. **N皇后方案输出**：返回所有具体的解
3. **约束条件变化**：如棋盘有障碍物等
4. **其他棋子问题**：如N车问题、N相问题等
5. **棋盘变形问题**：在不规则棋盘上放置棋子
6. **部分位置已知**：在已知部分皇后位置的情况下完成布局
7. **不同棋子组合**：在棋盘上同时放置皇后和其他棋子