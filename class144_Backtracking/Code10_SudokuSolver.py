"""
LeetCode 37. 解数独

题目描述：
编写一个程序，通过填充空格来解决数独问题。
数独的解法需遵循如下规则：
1. 数字 1-9 在每一行只能出现一次。
2. 数字 1-9 在每一列只能出现一次。
3. 数字 1-9 在每一个以粗实线分隔的 3x3 宫内只能出现一次。
空白格用 '.' 表示。

示例：
输入：
[
 ["5","3",".",".","7",".",".",".","."],
 ["6",".",".","1","9","5",".",".","."],
 [".","9","8",".",".",".",".","6","."],
 ["8",".",".",".","6",".",".",".","3"],
 ["4",".",".","8",".","3",".",".","1"],
 ["7",".",".",".","2",".",".",".","6"],
 [".","6",".",".",".",".","2","8","."],
 [".",".",".","4","1","9",".",".","5"],
 [".",".",".",".","8",".",".","7","9"]
]
输出：
[
 ["5","3","4","6","7","8","9","1","2"],
 ["6","7","2","1","9","5","3","4","8"],
 ["1","9","8","3","4","2","5","6","7"],
 ["8","5","9","7","6","1","4","2","3"],
 ["4","2","6","8","5","3","7","9","1"],
 ["7","1","3","9","2","4","8","5","6"],
 ["9","6","1","5","3","7","2","8","4"],
 ["2","8","7","4","1","9","6","3","5"],
 ["3","4","5","2","8","6","1","7","9"]
]

提示：
board.length == 9
board[i].length == 9
board[i][j] 是一位数字或者 '.'
题目数据保证输入数独仅有一个解

链接：https://leetcode.cn/problems/sudoku-solver/
"""

class Solution:
    def solveSudoku(self, board):
        """
        解决数独问题
        
        算法思路：
        1. 使用回溯算法解决数独问题
        2. 遍历棋盘，找到第一个空格
        3. 尝试填入1-9的数字，检查是否符合数独规则
        4. 如果符合规则，递归解决剩余空格
        5. 如果递归返回false，说明当前填法不正确，回溯并尝试下一个数字
        
        时间复杂度：O(9^(n*n))，最坏情况下每个空格都要尝试9个数字
        空间复杂度：O(n*n)，递归栈深度
        
        :param board: 数独棋盘
        """
        self.solve(board)
    
    def solve(self, board):
        """
        回溯函数解决数独
        
        :param board: 数独棋盘
        :return: 是否成功解决
        """
        for row in range(9):
            for col in range(9):
                # 找到空格
                if board[row][col] == '.':
                    # 尝试填入1-9
                    for c in map(str, range(1, 10)):
                        # 检查是否合法
                        if self.isValid(board, row, col, c):
                            board[row][col] = c
                            
                            # 递归求解
                            if self.solve(board):
                                return True
                            else:
                                board[row][col] = '.'  # 回溯
                    return False  # 1-9都尝试过都不行
        return True  # 全部填完
    
    def isValid(self, board, row, col, c):
        """
        检查在指定位置填入指定数字是否合法
        
        :param board: 数独棋盘
        :param row: 行索引
        :param col: 列索引
        :param c: 要填入的数字
        :return: 是否合法
        """
        for i in range(9):
            # 检查行
            if board[i][col] == c:
                return False
            # 检查列
            if board[row][i] == c:
                return False
            # 检查3x3子网格
            if board[3 * (row // 3) + i // 3][3 * (col // 3) + i % 3] == c:
                return False
        return True


# 打印数独棋盘
def printBoard(board):
    for i in range(9):
        if i % 3 == 0 and i != 0:
            print("------+-------+------")
        for j in range(9):
            if j % 3 == 0 and j != 0:
                print("| ", end="")
            print(board[i][j] + " ", end="")
        print()


# 测试方法
def main():
    solution = Solution()
    
    # 测试用例
    board = [
        ['5','3','.','.','7','.','.','.','.'],
        ['6','.','.','1','9','5','.','.','.'],
        ['.','9','8','.','.','.','.','6','.'],
        ['8','.','.','.','6','.','.','.','3'],
        ['4','.','.','8','.','3','.','.','1'],
        ['7','.','.','.','2','.','.','.','6'],
        ['.','6','.','.','.','.','2','8','.'],
        ['.','.','','.','4','1','9','.','.'],
        ['.','.','','.','.','8','.','7','9']
    ]
    
    print("数独题目:")
    printBoard(board)
    
    solution.solveSudoku(board)
    
    print("\n数独解答:")
    printBoard(board)


if __name__ == "__main__":
    main()