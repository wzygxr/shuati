#include <vector>
#include <iostream>

using namespace std;

/**
 * LeetCode 37. 解数独
 * 
 * 题目描述：
 * 编写一个程序，通过填充空格来解决数独问题。
 * 数独的解法需遵循如下规则：
 * 1. 数字 1-9 在每一行只能出现一次。
 * 2. 数字 1-9 在每一列只能出现一次。
 * 3. 数字 1-9 在每一个以粗实线分隔的 3x3 宫内只能出现一次。
 * 空白格用 '.' 表示。
 * 
 * 示例：
 * 输入：
 * [
 *  ["5","3",".",".","7",".",".",".","."],
 *  ["6",".",".","1","9","5",".",".","."],
 *  [".","9","8",".",".",".",".","6","."],
 *  ["8",".",".",".","6",".",".",".","3"],
 *  ["4",".",".","8",".","3",".",".","1"],
 *  ["7",".",".",".","2",".",".",".","6"],
 *  [".","6",".",".",".",".","2","8","."],
 *  [".",".",".","4","1","9",".",".","5"],
 *  [".",".",".",".","8",".",".","7","9"]
 * ]
 * 输出：
 * [
 *  ["5","3","4","6","7","8","9","1","2"],
 *  ["6","7","2","1","9","5","3","4","8"],
 *  ["1","9","8","3","4","2","5","6","7"],
 *  ["8","5","9","7","6","1","4","2","3"],
 *  ["4","2","6","8","5","3","7","9","1"],
 *  ["7","1","3","9","2","4","8","5","6"],
 *  ["9","6","1","5","3","7","2","8","4"],
 *  ["2","8","7","4","1","9","6","3","5"],
 *  ["3","4","5","2","8","6","1","7","9"]
 * ]
 * 
 * 提示：
 * board.length == 9
 * board[i].length == 9
 * board[i][j] 是一位数字或者 '.'
 * 题目数据保证输入数独仅有一个解
 * 
 * 链接：https://leetcode.cn/problems/sudoku-solver/
 */

class Solution {
public:
    /**
     * 解决数独问题
     * 
     * 算法思路：
     * 1. 使用回溯算法解决数独问题
     * 2. 遍历棋盘，找到第一个空格
     * 3. 尝试填入1-9的数字，检查是否符合数独规则
     * 4. 如果符合规则，递归解决剩余空格
     * 5. 如果递归返回false，说明当前填法不正确，回溯并尝试下一个数字
     * 
     * 时间复杂度：O(9^(n*n))，最坏情况下每个空格都要尝试9个数字
     * 空间复杂度：O(n*n)，递归栈深度
     * 
     * @param board 数独棋盘
     */
    void solveSudoku(vector<vector<char>>& board) {
        solve(board);
    }

private:
    /**
     * 回溯函数解决数独
     * 
     * @param board 数独棋盘
     * @return 是否成功解决
     */
    bool solve(vector<vector<char>>& board) {
        for (int row = 0; row < 9; row++) {
            for (int col = 0; col < 9; col++) {
                // 找到空格
                if (board[row][col] == '.') {
                    // 尝试填入1-9
                    for (char c = '1'; c <= '9'; c++) {
                        // 检查是否合法
                        if (isValid(board, row, col, c)) {
                            board[row][col] = c;
                            
                            // 递归求解
                            if (solve(board))
                                return true;
                            else
                                board[row][col] = '.'; // 回溯
                        }
                    }
                    return false; // 1-9都尝试过都不行
                }
            }
        }
        return true; // 全部填完
    }

    /**
     * 检查在指定位置填入指定数字是否合法
     * 
     * @param board 数独棋盘
     * @param row 行索引
     * @param col 列索引
     * @param c 要填入的数字
     * @return 是否合法
     */
    bool isValid(vector<vector<char>>& board, int row, int col, char c) {
        for (int i = 0; i < 9; i++) {
            // 检查行
            if (board[i][col] == c) return false;
            // 检查列
            if (board[row][i] == c) return false;
            // 检查3x3子网格
            if (board[3 * (row / 3) + i / 3][3 * (col / 3) + i % 3] == c) return false;
        }
        return true;
    }
};

// 打印数独棋盘
void printBoard(const vector<vector<char>>& board) {
    for (int i = 0; i < 9; i++) {
        if (i % 3 == 0 && i != 0) {
            cout << "------+-------+------" << endl;
        }
        for (int j = 0; j < 9; j++) {
            if (j % 3 == 0 && j != 0) {
                cout << "| ";
            }
            cout << board[i][j] << " ";
        }
        cout << endl;
    }
}

// 测试方法
int main() {
    Solution solution;
    
    // 测试用例
    vector<vector<char>> board = {
        {'5','3','.','.','7','.','.','.','.'},
        {'6','.','.','1','9','5','.','.','.'},
        {'.','9','8','.','.','.','.','6','.'},
        {'8','.','.','.','6','.','.','.','3'},
        {'4','.','.','8','.','3','.','.','1'},
        {'7','.','.','.','2','.','.','.','6'},
        {'.','6','.','.','.','.','2','8','.'},
        {'.','.','.','4','1','9','.','.','5'},
        {'.','.','.','.','8','.','.','7','9'}
    };
    
    cout << "数独题目:" << endl;
    printBoard(board);
    
    solution.solveSudoku(board);
    
    cout << "\n数独解答:" << endl;
    printBoard(board);
    
    return 0;
}