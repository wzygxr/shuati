# 全面线段树合并算法题目集合

## 一、基础线段树合并题目

### 1. USACO17JAN Promotion Counting (晋升者计数)
- **题目来源**: USACO 2017 January Contest, Platinum Problem 1
- **题目链接**: https://www.luogu.com.cn/problem/P3605
- **题目描述**: 给定一棵树，每个节点有一个能力值，统计每个节点的子树中能力值严格大于该节点的节点数量
- **算法**: 线段树合并 + 离散化
- **难度**: 中等
- **最优解**: 是

### 2. Vani有约会 雨天的尾巴 (Rainy Day Tail)
- **题目来源**: 洛谷P4556
- **题目链接**: https://www.luogu.com.cn/problem/P4556
- **题目描述**: 在树上路径上投放物品，统计每个节点收到最多物品的类型
- **算法**: 树上差分 + 线段树合并
- **难度**: 困难
- **最优解**: 是

### 3. NOIP2016 天天爱跑步 (Running Everyday)
- **题目来源**: NOIP 2016 提高组 D1T2
- **题目链接**: https://www.luogu.com.cn/problem/P1600
- **题目描述**: 树上路径统计问题，观察员只观察特定时间经过的选手
- **算法**: 线段树合并 + 树上差分
- **难度**: 困难
- **最优解**: 是

### 4. HNOI2012 永无乡 (Neverland)
- **题目来源**: HNOI2012
- **题目链接**: https://www.luogu.com.cn/problem/P3224
- **题目描述**: 维护岛屿连通性，支持查询连通块中第k重要的岛屿
- **算法**: 并查集 + 线段树合并
- **难度**: 中等
- **最优解**: 是

### 5. POI2011 Tree Rotations (树旋转)
- **题目来源**: POI2011
- **题目链接**: https://www.luogu.com.cn/problem/P3521
- **题目描述**: 二叉树叶子节点权值排列，通过交换左右子树最小化逆序对数
- **算法**: 线段树合并 + 逆序对计算
- **难度**: 困难
- **最优解**: 是

### 6. Codeforces 1009F Dominant Indices (主导下标)
- **题目来源**: Codeforces Round #494 (Div. 3)
- **题目链接**: https://codeforces.com/problemset/problem/1009/F
- **题目描述**: 对每个节点求子树中哪个深度的节点数量最多
- **算法**: 线段树合并 + 深度统计
- **难度**: 困难
- **最优解**: 是

### 7. Codeforces 600E Lomsat gelral (颜色统计)
- **题目来源**: Codeforces Round #286 (Div. 1)
- **题目链接**: https://codeforces.com/problemset/problem/600/E
- **题目描述**: 求每个子树中出现次数最多的颜色的颜色值之和
- **算法**: 线段树合并 + 颜色统计
- **难度**: 中等
- **最优解**: 是

## 二、高级线段树合并题目

### 8. Codeforces 1336F Journey (旅程)
- **题目来源**: Codeforces Round #635 (Div. 1)
- **题目链接**: https://codeforces.com/problemset/problem/1336/F
- **题目描述**: 给定一棵树和一些路径，求所有路径交的长度为k的点对数
- **算法**: 虚树 + 线段树合并
- **难度**: 困难
- **最优解**: 是

### 9. Codeforces 932F Escape Through Leaf (逃离叶子)
- **题目来源**: Codeforces Round #463 (Div. 1)
- **题目链接**: https://codeforces.com/problemset/problem/932/F
- **题目描述**: 树上DP问题，从每个节点跳到子树中叶子节点的最小花费
- **算法**: 李超树 + 线段树合并
- **难度**: 困难
- **最优解**: 是

### 10. PKUWC2018 Minimax (最小最大值)
- **题目来源**: PKU Winter Camp 2018
- **题目链接**: https://www.luogu.com.cn/problem/P5298
- **题目描述**: 树上概率DP问题，每个节点有一定概率取子节点的最大值或最小值
- **算法**: 线段树合并 + 概率分布维护
- **难度**: 困难
- **最优解**: 是

### 11. Codeforces 570D Tree Requests (树请求)
- **题目来源**: Codeforces Round #315 (Div. 1)
- **题目链接**: https://codeforces.com/problemset/problem/570/D
- **题目描述**: 查询某个子树在特定深度的字符能否重排成回文串
- **算法**: 线段树合并 + 字符统计
- **难度**: 中等
- **最优解**: 是

### 12. Codeforces 240F TorCoder (字符串排序)
- **题目来源**: Codeforces Round #146 (Div. 1)
- **题目链接**: https://codeforces.com/problemset/problem/240/F
- **题目描述**: 给定一个字符串，支持区间排序操作和查询
- **算法**: 线段树合并 + 平衡树
- **难度**: 困难
- **最优解**: 是

## 三、线段树合并变种题目

### 13. HDU 6315 Naive Operations (朴素操作)
- **题目来源**: HDU Multi-University Training Contest 2019
- **题目链接**: https://acm.hdu.edu.cn/showproblem.php?pid=6315
- **题目描述**: 维护两个数组，支持区间加法和区间查询向下取整a[i]/b[i]的和
- **算法**: 线段树合并 + 区间操作
- **难度**: 困难
- **最优解**: 是

### 14. POJ 3667 Hotel (酒店)
- **题目来源**: POJ
- **题目链接**: http://poj.org/problem?id=3667
- **题目描述**: 维护一个序列，支持查询连续空房间和区间占用操作
- **算法**: 线段树区间合并
- **难度**: 中等
- **最优解**: 是

### 15. UOJ #46 玄学 (神秘学)
- **题目来源**: UOJ
- **题目链接**: https://uoj.ac/problem/46
- **题目描述**: 维护一个序列，支持区间赋值和单点查询操作
- **算法**: 二进制分组线段树
- **难度**: 困难
- **最优解**: 是

### 16. Codeforces 765F Souvenirs (纪念品)
- **题目来源**: Codeforces Round #397 (Div. 1)
- **题目链接**: https://codeforces.com/problemset/problem/765/F
- **题目描述**: 给定一个序列，多次询问区间内两个不同位置元素差的最小值
- **算法**: 线段树合并 + 分治
- **难度**: 困难
- **最优解**: 是

### 17. Codeforces 914D Bash and a Tough Math Puzzle (Bash和困难数学谜题)
- **题目来源**: Codeforces Round #458 (Div. 1)
- **题目链接**: https://codeforces.com/problemset/problem/914/D
- **题目描述**: 给定一个数组，支持修改元素和查询区间内能否通过最多修改一个元素使所有元素都是某个数的倍数
- **算法**: 线段树合并 + 线段树上二分
- **难度**: 困难
- **最优解**: 是

### 18. Codeforces 960F Pathwalks (路径行走)
- **题目来源**: Codeforces Round #474 (Div. 1)
- **题目链接**: https://codeforces.com/problemset/problem/960/F
- **题目描述**: 给定一个有向图，求最长上升路径（边权严格递增）
- **算法**: 线段树合并 + DP状态维护
- **难度**: 困难
- **最优解**: 是

### 19. Codeforces 993E Nikita and Order Statistics (Nikita和顺序统计)
- **题目来源**: Codeforces Round #488 (Div. 1)
- **题目链接**: https://codeforces.com/problemset/problem/993/E
- **题目描述**: 给定一个数组和一个阈值，对每个k计算恰好有k个元素小于阈值的连续子数组个数
- **算法**: FFT + 线段树合并
- **难度**: 困难
- **最优解**: 是

## 四、线段树合并工程化题目

### 20. 洛谷P4197 Peaks (山峰)
- **题目来源**: 洛谷
- **题目链接**: https://www.luogu.com.cn/problem/P4197
- **题目描述**: 在线查询区间第k小值
- **算法**: 线段树合并 + 主席树
- **难度**: 困难
- **最优解**: 是

### 21. 洛谷P4211 [LNOI2014]LCA
- **题目来源**: 洛谷
- **题目链接**: https://www.luogu.com.cn/problem/P4211
- **题目描述**: 多次询问区间内每个点到根节点路径的并集大小
- **算法**: 树链剖分 + 线段树合并
- **难度**: 困难
- **最优解**: 是

### 22. 洛谷P4719 【模板】动态DP
- **题目来源**: 洛谷
- **题目链接**: https://www.luogu.com.cn/problem/P4719
- **题目描述**: 动态维护树上最大独立集
- **算法**: 线段树合并 + 动态DP
- **难度**: 困难
- **最优解**: 是

## 五、线段树合并技巧总结

### 5.1 常见应用场景
1. **树上统计问题**: 子树信息合并、深度统计、权值统计等
2. **连通性维护**: 结合并查集维护连通块信息
3. **序列与区间问题**: 逆序对统计、区间信息合并等
4. **动态数据结构**: 处理动态变化的数据集合

### 5.2 时间复杂度分析
- **单次合并**: O(log n)
- **总时间复杂度**: O(n log n)
- **空间复杂度**: O(n log n)

### 5.3 实现技巧
1. **动态开点**: 只在需要时创建节点，节省空间
2. **递归合并**: 自底向上合并线段树节点
3. **信息维护**: 根据问题需求设计合适的节点信息和合并方式
4. **树上应用**: 通常采用后序遍历的方式，先处理子节点，再合并信息

### 5.4 工程化考量
1. **异常处理**: 空指针检查、边界条件处理
2. **性能优化**: 垃圾回收机制、标记永久化技术
3. **调试技巧**: 打印中间状态、小数据测试、边界测试

## 六、学习路径建议

### 6.1 基础阶段
1. 理解线段树的基本操作（建树、查询、修改）
2. 掌握动态开点线段树
3. 学习线段树合并的基本思想

### 6.2 进阶阶段
1. 练习经典题目（晋升者计数、永无乡等）
2. 理解各种信息的维护方式
3. 掌握树上差分技术

### 6.3 高级阶段
1. 学习优化技巧（垃圾回收、标记永久化等）
2. 练习复杂题目（Tree Rotations等）
3. 理解与其他算法的结合应用

### 6.4 精通阶段
1. 深入理解线段树的各种变种
2. 掌握线段树在竞赛中的应用
3. 能够设计复杂的线段树解决方案

通过系统学习以上内容，可以全面掌握线段树合并算法，为算法竞赛和工程实践打下坚实基础。