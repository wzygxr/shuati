# 分块算法详解与全平台经典题目汇总

## 算法简介

分块是一种基于"分而治之"思想的数据结构优化技巧，它将一个大的数据集分割成若干个大小相近的块，通过对每个块维护一些信息来优化区间操作的效率。

### 核心思想

分块的核心思想是将长度为n的序列分成√n个块，每块大小也为√n（最后一块可能不足√n个元素）。这样做的好处是：
1. 对于区间操作，最多涉及O(√n)个完整的块
2. 区间两端不完整的块元素个数总共不超过2√n
3. 通过预处理和标记技术，可以有效降低时间复杂度

### 时间复杂度分析

对于大多数分块操作，时间复杂度为O(√n)或O(√n * log(√n))，具体取决于：
- 不完整块的处理方式（通常是暴力处理）
- 完整块的优化策略（使用标记、预处理等）
- 块内数据结构的选择（数组、排序数组、TreeSet等）

## LibreOJ分块入门9题详解

### 1. 数列分块入门1 (LibreOJ #6277)
**题目要求**：区间加法，单点查值
**核心技巧**：懒惰标记
**时间复杂度**：O(√n) / 操作

对于每个块维护一个加法标记，区间加法时：
- 不完整块：暴力修改元素值
- 完整块：更新加法标记

查询时返回元素值加上所在块的加法标记。

### 2. 数列分块入门2 (LibreOJ #6278)
**题目要求**：区间加法，询问区间内小于某个值x的元素个数
**核心技巧**：排序 + 二分查找
**时间复杂度**：O(√n * log(√n)) / 操作

在分块基础上：
- 每个块内维护有序数组
- 区间加法时需要重构不完整块的有序数组
- 查询时用二分查找优化完整块的统计

### 3. 数列分块入门3 (LibreOJ #6279)
**题目要求**：区间加法，询问区间内小于某个值x的前驱（比其小的最大元素）
**核心技巧**：有序数据结构（TreeSet或有序数组）
**时间复杂度**：O(√n * log(√n)) / 操作

与第2题类似，但查询操作改为查找前驱元素。

### 4. 数列分块入门4 (LibreOJ #6280)
**题目要求**：区间加法，区间求和
**核心技巧**：维护块元素和
**时间复杂度**：O(√n) / 操作

对每个块维护元素和：
- 区间加法时更新不完整块的元素和
- 完整块通过标记直接计算增量

### 5. 数列分块入门5 (LibreOJ #6281)
**题目要求**：区间开方，区间求和
**核心技巧**：标记优化
**时间复杂度**：O(√n) 均摊 / 操作

观察到一个数经过几次开方后会变成0或1，因此：
- 对每个块标记是否所有元素都为0或1
- 如果是，则区间开方操作可跳过该块
- 否则暴力处理并更新标记

### 6. 数列分块入门6 (LibreOJ #6282)
**题目要求**：单点插入，单点询问
**核心技巧**：动态分块 + 重构
**时间复杂度**：O(√n) 均摊 / 操作

使用动态数组存储每个块：
- 插入时在相应位置插入元素
- 当某个块过大时进行重构
- 重构操作将所有元素重新平均分配到块中

### 7. 数列分块入门7 (LibreOJ #6283)
**题目要求**：区间乘法，区间加法，单点询问
**核心技巧**：标记优先级
**时间复杂度**：O(√n) / 操作

维护两个标记（乘法标记和加法标记）：
- 乘法标记优先级高于加法标记
- 标记合并时需要考虑优先级关系
- 查询时根据标记计算实际值

### 8. 数列分块入门8 (LibreOJ #6284)
**题目要求**：区间询问等于一个数c的元素个数，并将区间所有元素改为c
**核心技巧**：标记优化
**时间复杂度**：O(√n) 均摊 / 操作

对每个块维护标记表示整个块是否为同一值：
- 如果是，则可直接计算结果
- 否则暴力处理并更新标记

### 9. 数列分块入门9 (LibreOJ #6285)
**题目要求**：询问区间的最小众数
**核心技巧**：预处理 + 统计优化
**时间复杂度**：O(√n) / 查询

预处理f[i][j]表示第i块到第j块的最小众数：
- 查询时结合预处理结果和两端不完整块暴力统计
- 通过预处理避免每次都统计完整块

## 全平台分块算法经典题目汇总

### 10. SPOJ GIVEAWAY (Code01_GiveAway1.java/Code01_GiveAway2.java)
**题目要求**：区间查询大于等于某个值的元素个数，单点修改
**核心技巧**：排序 + 二分查找
**时间复杂度**：O(√n * log(√n)) / 操作
**测试链接**：https://www.spoj.com/problems/GIVEAWAY/

### 11. SPOJ DQUERY (Code02_Magic1.java/Code02_Magic2.java)
**题目要求**：区间查询不同元素个数
**核心技巧**：莫队算法 + 分块
**时间复杂度**：O(√n) 均摊 / 操作
**测试链接**：https://www.spoj.com/problems/DQUERY/

### 12. [Violet]蒲公英 (Code03_Violet1.java/Code03_Violet2.java)
**题目要求**：区间查询众数
**核心技巧**：预处理 + 分块
**时间复杂度**：O(√n) / 查询
**测试链接**：https://www.luogu.com.cn/problem/P4168

### 13. Mode Counting (Code04_ModeCnt1.java/Code04_ModeCnt2.java)
**题目要求**：区间查询众数出现次数
**核心技巧**：预处理 + 分块
**时间复杂度**：O(√n) / 查询

### 14. Poem (Code05_Poem1.java/Code05_Poem2.java)
**题目要求**：区间查询回文子串个数
**核心技巧**：Manacher算法 + 分块
**时间复杂度**：O(√n * n) / 查询

### 15. Text Editor (Code06_TextEditor1.java/Code06_TextEditor2.java)
**题目要求**：文本编辑器操作（插入、删除、查询）
**核心技巧**：块状链表 + 分块
**时间复杂度**：O(√n) 均摊 / 操作

## 高级分块应用题目

### 16. 数列分块入门6扩展 (Code16_BlockIntro6_Java.java/Code16_BlockIntro6_C++.cpp/Code16_BlockIntro6_Python.py)
**题目要求**：单点插入，单点查询
**核心技巧**：动态分块 + 重构
**时间复杂度**：O(√n) 均摊 / 操作
**测试链接**：https://loj.ac/p/6282

### 17. 数列分块入门7扩展 (Code17_BlockIntro7_Java.java/Code17_BlockIntro7_C++.cpp/Code17_BlockIntro7_Python.py)
**题目要求**：区间乘法，区间加法，单点查询
**核心技巧**：标记优先级
**时间复杂度**：O(√n) / 操作
**测试链接**：https://loj.ac/p/6283

### 18. 数列分块入门8扩展 (Code18_BlockIntro8_Java.java/Code18_BlockIntro8_C++.cpp/Code18_BlockIntro8_Python.py)
**题目要求**：区间查询等于某个值的元素个数，区间修改为同一值
**核心技巧**：标记优化
**时间复杂度**：O(√n) 均摊 / 操作
**测试链接**：https://loj.ac/p/6284

### 19. 数列分块入门9扩展 (Code19_BlockIntro9_Java.java/Code19_BlockIntro9_C++.cpp/Code19_BlockIntro9_Python.py)
**题目要求**：区间查询最小众数
**核心技巧**：预处理 + 统计优化
**时间复杂度**：O(√n) / 查询
**测试链接**：https://loj.ac/p/6285

## 其他经典分块题目

### 20. UVA 12003 Array Transformer
**题目要求**：区间查询小于某个值的元素个数，单点修改
**核心技巧**：分块 + 排序 + 二分查找
**时间复杂度**：O(√n * log(√n)) / 操作
**测试链接**：https://vjudge.net/problem/UVA-12003

### 21. POJ 2104 K-th Number
**题目要求**：区间查询第k小元素
**核心技巧**：分块 + 排序 + 二分答案
**时间复杂度**：O(√n * log(n)) / 查询
**测试链接**：http://poj.org/problem?id=2104

### 22. CodeChef COUNTARI
**题目要求**：统计满足等差数列条件的三元组个数
**核心技巧**：分块 + FFT
**时间复杂度**：O(n * √n * log(n)) / 操作
**测试链接**：https://www.codechef.com/problems/COUNTARI

### 23. CodeChef FNCS
**题目要求**：区间函数求和，单点修改
**核心技巧**：分块 + 前缀和
**时间复杂度**：O(√n) / 操作
**测试链接**：https://www.codechef.com/problems/FNCS

### 24. Codeforces 617E XOR and Favorite Number
**题目要求**：区间查询异或值等于k的子区间个数
**核心技巧**：莫队算法 + 分块
**时间复杂度**：O(n * √n) / 操作
**测试链接**：https://codeforces.com/problemset/problem/617/E

### 25. Codeforces 220B Little Elephant and Array
**题目要求**：区间查询"好数"个数（好数定义为在区间中出现次数等于其值的数）
**核心技巧**：莫队算法 + 分块
**时间复杂度**：O(n * √n) / 操作
**测试链接**：https://codeforces.com/problemset/problem/220/B

### 26. Codeforces 86D Powerful Array
**题目要求**：区间查询"能量值"（每个数的贡献为该数出现次数的平方乘以该数）
**核心技巧**：莫队算法 + 分块
**时间复杂度**：O(n * √n) / 操作
**测试链接**：https://codeforces.com/problemset/problem/86/D

### 27. Codeforces 1129D Isolation
**题目要求**：划分数组使得每段中只出现一次的元素个数不超过k
**核心技巧**：分块优化DP
**时间复杂度**：O(n * √n) / 操作
**测试链接**：https://codeforces.com/problemset/problem/1129/D

### 28. Codeforces 915E Physical Education Lessons
**题目要求**：区间染色，查询白色区间个数
**核心技巧**：分块 + 懒惰标记
**时间复杂度**：O(√n) / 操作
**测试链接**：https://codeforces.com/problemset/problem/915/E

### 29. HYSBZ 2038 小Z的袜子
**题目要求**：区间查询相同颜色袜子对的概率
**核心技巧**：莫队算法 + 分块
**时间复杂度**：O(n * √n) / 操作
**测试链接**：https://www.lydsy.com/JudgeOnline/problem.php?id=2038

### 30. HYSBZ 2741 【FOTILE模拟赛】L
**题目要求**：区间查询最大连续异或和
**核心技巧**：分块 + 可持久化Trie
**时间复杂度**：O(n * √n) / 操作
**测试链接**：https://www.lydsy.com/JudgeOnline/problem.php?id=2741

### 31. HDU 5381 The sum of gcd
**题目要求**：区间查询所有子区间的GCD之和
**核心技巧**：分块预处理
**时间复杂度**：O(n * √n * log n) / 操作
**测试链接**：http://acm.hdu.edu.cn/showproblem.php?pid=5381

### 32. 牛客网 NC15277 区间异或和
**题目要求**：区间异或操作，单点查询
**核心技巧**：分块标记
**时间复杂度**：O(√n) / 操作
**测试链接**：https://ac.nowcoder.com/acm/problem/15277

### 33. 洛谷 P5356 由乃打扑克
**题目要求**：区间查询第k小，区间加法
**核心技巧**：分块排序 + 二分答案
**时间复杂度**：O(√n * log n) / 查询
**测试链接**：https://www.luogu.com.cn/problem/P5356

### 34. 力扣 LeetCode 307. 区域和检索 - 数组可修改
**题目要求**：区间求和，单点修改
**核心技巧**：分块维护区间和
**时间复杂度**：O(√n) / 操作
**测试链接**：https://leetcode.cn/problems/range-sum-query-mutable/

### 35. 计蒜客 T1131 数列区间最大值
**题目要求**：区间最大值查询，单点修改
**核心技巧**：分块维护区间最大值
**时间复杂度**：O(√n) / 操作
**测试链接**：https://nanti.jisuanke.com/t/T1131

### 36. 杭电 HDU 1556 Color the ball
**题目要求**：区间更新，单点查询
**核心技巧**：分块标记
**时间复杂度**：O(√n) / 操作
**测试链接**：http://acm.hdu.edu.cn/showproblem.php?pid=1556

### 37. 洛谷 P2054 [AHOI2005] 洗牌
**题目要求**：模拟洗牌过程，查询最终位置
**核心技巧**：分块优化模拟
**时间复杂度**：O(√n) / 操作
**测试链接**：https://www.luogu.com.cn/problem/P2054

### 38. 牛客网 NC24210 区间加区间求和
**题目要求**：区间加法，区间求和
**核心技巧**：分块维护区间和
**时间复杂度**：O(√n) / 操作
**测试链接**：https://ac.nowcoder.com/acm/problem/24210

### 39. AtCoder ABC174 F Range Set Query
**题目要求**：区间查询不同元素个数
**核心技巧**：莫队算法 + 分块
**时间复杂度**：O(n√n) / 操作
**测试链接**：https://atcoder.jp/contests/abc174/tasks/abc174_f

### 40. Codeforces 103D Time to Raid Cowavans
**题目要求**：多次跳跃查询区间和
**核心技巧**：分块预处理
**时间复杂度**：O(n√n) 预处理，O(√n) 查询
**测试链接**：https://codeforces.com/problemset/problem/103/D

### 41. 力扣 LeetCode 2439. 最小化数组中的最大值
**题目要求**：将数组分成k个子数组，最小化子数组最大值
**核心技巧**：分块 + 贪心
**时间复杂度**：O(n log n) / 操作
**测试链接**：https://leetcode.cn/problems/minimize-maximum-of-array/

### 42. 赛码网 区间修改区间查询
**题目要求**：区间乘法，区间加法，区间求和
**核心技巧**：分块双标记
**时间复杂度**：O(√n) / 操作
**测试链接**：https://www.acmcoder.com/#/problem/

### 43. HackerEarth Range Query Challenges
**题目要求**：区间查询不同元素个数
**核心技巧**：分块 + 预处理
**时间复杂度**：O(n√n) / 操作
**测试链接**：https://www.hackerearth.com/practice/data-structures/advanced-data-structures/fenwick-binary-indexed-trees/practice-problems/

### 44. UVa 11990 Dynamic Inversion
**题目要求**：动态维护逆序对数量
**核心技巧**：分块 + 树状数组
**时间复杂度**：O(n√n log n) / 操作
**测试链接**：https://onlinejudge.org/index.php?option=com_onlinejudge&Itemid=8&category=24&page=show_problem&problem=3141

### 45. 剑指Offer 03. 数组中重复的数字
**题目要求**：查找数组中重复的数字
**核心技巧**：分块统计
**时间复杂度**：O(n) / 操作
**测试链接**：https://leetcode.cn/problems/shu-zu-zhong-zhong-fu-de-shu-zi-lcof/

### 46. 杭电 HDU 5072 Coprime
**题目要求**：区间查询与给定数互质的元素个数
**核心技巧**：分块 + 容斥原理
**时间复杂度**：O(n√n * 2^m) / 操作，其中m是质因数个数
**测试链接**：http://acm.hdu.edu.cn/showproblem.php?pid=5072

### 47. Codeforces 486E LIS of Sequence
**题目要求**：求序列的最长递增子序列相关信息
**核心技巧**：分块预处理
**时间复杂度**：O(n√n) / 操作
**测试链接**：https://codeforces.com/problemset/problem/486/E

### 48. 洛谷 P1494 [国家集训队] 小 Z 的袜子
**题目要求**：区间查询相同颜色袜子对的概率
**核心技巧**：莫队算法 + 分块
**时间复杂度**：O(n√n) / 操作
**测试链接**：https://www.luogu.com.cn/problem/P1494

### 49. Project Euler 283 Integer sided triangles for which the area is a multiple of the perimeter
**题目要求**：统计满足条件的三角形数量
**核心技巧**：分块优化枚举
**时间复杂度**：O(n√n) / 操作
**测试链接**：https://projecteuler.net/problem=283

### 50. HackerRank Frequency Queries
**题目要求**：维护频率信息的查询
**核心技巧**：分块统计频率
**时间复杂度**：O(n√n) / 操作
**测试链接**：https://www.hackerrank.com/challenges/frequency-queries/problem

## 分块算法的高级应用

### 1. 树上分块
在树结构上应用分块思想，处理树上路径查询问题。

### 2. 二维分块
对二维矩阵进行分块处理，优化区间查询和更新操作。

### 3. 莫队算法
基于分块思想的离线算法，用于处理区间查询问题。

### 4. 整体二分
结合分块思想进行整体二分，优化某些特定问题的求解。

### 5. 双层分块
对数据进行两层分块处理，进一步优化时间复杂度。

## 分块与其他数据结构的结合

### 1. 分块 + 线段树
在块内使用线段树维护信息，结合两者优势。

### 2. 分块 + 并查集
在块内使用并查集维护连通性信息。

### 3. 分块 + Trie树
在块内使用Trie树维护字符串信息。

### 4. 分块 + 平衡树
在块内使用平衡树维护有序信息。

## 分块算法的应用场景

1. **区间更新与查询**：当线段树等高级数据结构难以维护时
2. **在线算法**：相比莫队算法，分块更适合在线处理
3. **复杂操作**：可以灵活维护块内数据结构以支持复杂操作
4. **内存敏感**：相比线段树，分块通常使用更少的内存

## 分块算法的优缺点

### 优点
1. **实现简单**：相比线段树、平衡树等，分块更容易实现
2. **灵活性高**：可以根据具体需求维护不同的块内信息
3. **调试方便**：结构清晰，容易调试和验证正确性
4. **适用面广**：能处理许多线段树难以维护的操作

### 缺点
1. **常数较大**：相比线段树，分块的常数通常较大
2. **时间复杂度略逊**：多数情况下不如线段树等数据结构
3. **空间利用**：可能需要额外空间维护块内信息

## 工程化考量

1. **边界处理**：特别注意处理数组边界和最后一块大小不足的情况
2. **标记下传**：正确实现标记的下传机制，避免逻辑错误
3. **重构策略**：合理设计重构条件，平衡时间复杂度
4. **内存管理**：在大规模数据下注意内存使用情况
5. **性能优化**：通过预处理、标记优化等技术提升性能

## 总结

分块作为一种优雅的暴力算法，在处理区间操作问题时具有独特的优势。虽然时间复杂度不如线段树等高级数据结构，但其实现简单、灵活性高的特点使其在竞赛和工程中都有广泛应用。掌握分块算法不仅有助于解决特定问题，更能加深对数据结构设计思想的理解。