# 莫队二次离线算法相关题目汇总

## 1. 洛谷 P4887 【模板】莫队二次离线（第十四分块(前体)）

### 题目描述
给定一个长度为n的数组arr，给定一个非负整数k，下面给出k1二元组的定义：
位置二元组(i, j)，i和j必须是不同的，并且 arr[i]异或arr[j] 的二进制状态里有k个1。
当i != j时，(i, j)和(j, i)认为是相同的二元组。
一共有m条查询，格式为 l r : 打印arr[l..r]范围上，有多少k1二元组。

### 输入格式
第一行三个整数n, m, k
第二行n个整数表示数组arr
接下来m行，每行两个整数l, r表示查询区间

### 输出格式
对于每个查询，输出一行一个整数表示答案

### 数据范围
1 <= n、m <= 10^5
0 <= arr[i]、k < 16384(2的14次方)

### 题目链接
https://www.luogu.com.cn/problem/P4887

## 2. 洛谷 P5501 [LnOI2019] 来者不拒，去者不追

### 题目描述
给定一个长度为n的数组arr，定义区间[l,r]的价值为：
对于区间内每个元素x，其贡献为(x * (小于x的元素个数 + 1) + 大于x的元素和)
查询m个区间的价值和。

### 输入格式
第一行两个整数n, m
第二行n个整数表示数组arr
接下来m行，每行两个整数l, r表示查询区间

### 输出格式
对于每个查询，输出一行一个整数表示答案

### 数据范围
1 <= n, m <= 5 * 10^5
1 <= arr[i] <= 10^5

### 题目链接
https://www.luogu.com.cn/problem/P5501

## 3. 洛谷 P5398 [Ynoi2019 模拟赛] Yuno loves sqrt technology II

### 题目描述
给定一个长度为n的数组arr，定义倍数二元组：
如果arr[i]是arr[j]的倍数(>=1倍)，那么(i, j)就是一个倍数二元组。
当i != j时，(i, j)和(j, i)认为是不同的二元组，不要漏算。
当i == j时，(i, j)和(j, i)认为是相同的二元组，不要多算。
一共有m条查询，格式为 l r : 打印arr[l..r]范围上，有多少倍数二元组。

### 输入格式
第一行两个整数n, m
第二行n个整数表示数组arr
接下来m行，每行两个整数l, r表示查询区间

### 输出格式
对于每个查询，输出一行一个整数表示答案

### 数据范围
1 <= n、m、arr[i] <= 5 * 10^5

### 题目链接
https://www.luogu.com.cn/problem/P5398

## 4. 洛谷 P5047 [Ynoi2019 模拟赛] Yuno loves sqrt technology III

### 题目描述
给定一个长度为n的数组arr，如果i < j，并且arr[i] > arr[j]，那么(i,j)就是逆序对。
一共有m条查询，格式为 l r : 打印arr[l..r]范围上，逆序对的数量。

### 输入格式
第一行两个整数n, m
第二行n个整数表示数组arr
接下来m行，每行两个整数l, r表示查询区间

### 输出格式
对于每个查询，输出一行一个整数表示答案

### 数据范围
1 <= n、m <= 10^5
0 <= arr[i] <= 10^9

### 题目链接
https://www.luogu.com.cn/problem/P5047

## 5. Codeforces 617E XOR and Favorite Number

### 题目描述
给定一个长度为n的数组arr和一个值k，有m次查询。
每次查询[l,r]区间内，有多少个子区间[l'<=l, r'>=r]满足异或和等于k。

### 输入格式
第一行三个整数n, m, k
第二行n个整数表示数组arr
接下来m行，每行两个整数l, r表示查询区间

### 输出格式
对于每个查询，输出一行一个整数表示答案

### 数据范围
1 <= n, m <= 100000
1 <= k, arr[i] <= 1000000

### 题目链接
https://codeforces.com/contest/617/problem/E

## 6. SPOJ DQUERY - D-query

### 题目描述
给定一个长度为n的数组arr，有m次查询。
每次查询[l,r]区间内，有多少个不同的数。

### 输入格式
第一行一个整数n
第二行n个整数表示数组arr
第三行一个整数m
接下来m行，每行两个整数l, r表示查询区间

### 输出格式
对于每个查询，输出一行一个整数表示答案

### 数据范围
1 <= n <= 30000
1 <= q <= 200000
1 <= arr[i] <= 10^6

### 题目链接
https://www.spoj.com/problems/DQUERY/

## 7. 洛谷 P2709 小B的询问

### 题目描述
给定一个长度为n的数组arr，有m次查询。
每次查询[l,r]区间内，每种数字出现次数的平方和。

### 输入格式
第一行两个整数n, m
第二行n个整数表示数组arr
接下来m行，每行两个整数l, r表示查询区间

### 输出格式
对于每个查询，输出一行一个整数表示答案

### 数据范围
1 <= n, m <= 50000
1 <= k <= n
1 <= arr[i] <= n

### 题目链接
https://www.luogu.com.cn/problem/P2709

## 8. 洛谷 P1903 [国家集训队] 数颜色 / 维护队列

### 题目描述
给定一个长度为n的数组arr，支持两种操作：
1. Q l r: 查询区间[l,r]内不同颜色的个数
2. R pos val: 将位置pos的颜色修改为val

### 输入格式
第一行两个整数n, m
第二行n个整数表示数组arr
接下来m行，每行表示一个操作

### 输出格式
对于每个查询操作，输出一行一个整数表示答案

### 数据范围
1 <= n, m <= 10000
颜色编号在32位整数范围内

### 题目链接
https://www.luogu.com.cn/problem/P1903

## 9. AtCoder AT1219 歴史の研究

### 题目描述
给定一个长度为n的数组arr，有m次查询。
每次查询[l,r]区间内，数字与其出现次数乘积的最大值。

### 输入格式
第一行两个整数n, m
第二行n个整数表示数组arr
接下来m行，每行两个整数l, r表示查询区间

### 输出格式
对于每个查询，输出一行一个整数表示答案

### 数据范围
1 <= n <= 100000
1 <= m <= 100000
1 <= arr[i] <= 10^9

### 题目链接
https://www.luogu.com.cn/problem/AT1219

## 10. 洛谷 P4688 [Ynoi2016] 掉进兔子洞

### 题目描述
给定一个长度为n的数组arr，有m次查询。
每次查询给出3个区间，求这些区间中出现次数最少的元素的出现次数之和。

### 输入格式
第一行两个整数n, m
第二行n个整数表示数组arr
接下来m行，每行6个整数l1, r1, l2, r2, l3, r3表示3个查询区间

### 输出格式
对于每个查询，输出一行一个整数表示答案

### 数据范围
1 <= n, m <= 100000
1 <= arr[i] <= 10^9

### 题目链接
https://www.luogu.com.cn/problem/P4688

## 11. 洛谷 P5231 [JSOI2012] 玄武密码

### 题目描述
给定一个主串和多个模式串，查询每个模式串在主串中匹配的最长前缀长度。

### 输入格式
第一行两个整数n, m
第二行一个长度为n的字符串表示主串
接下来m行，每行一个字符串表示模式串

### 输出格式
对于每个模式串，输出一行一个整数表示最长前缀长度

### 数据范围
1 <= n <= 10000000
1 <= m <= 200000
模式串总长度 <= 200000

### 题目链接
https://www.luogu.com.cn/problem/P5231

## 12. 洛谷 P4887 【模板】莫队二次离线（第十四分块(前体)）

### 题目描述
给定一个长度为n的数组arr和一个非负整数k，定义k1二元组为满足arr[i] XOR arr[j]的二进制表示中有k个1的二元组(i,j)，查询区间内k1二元组的个数。

### 输入格式
第一行三个整数n, m, k
第二行n个整数表示数组arr
接下来m行，每行两个整数l, r表示查询区间

### 输出格式
对于每个查询，输出一行一个整数表示答案

### 数据范围
1 <= n、m <= 10^5
0 <= arr[i]、k < 16384(2的14次方)

### 题目链接
https://www.luogu.com.cn/problem/P4887

## 13. 洛谷 P3604 美好的每一天

### 题目描述
给定一个字符串，查询区间内能重排成回文串的子串个数。

### 输入格式
第一行一个字符串s
第二行一个整数m
接下来m行，每行两个整数l, r表示查询区间

### 输出格式
对于每个查询，输出一行一个整数表示答案

### 数据范围
1 <= |s| <= 60000
1 <= m <= 60000

### 题目链接
https://www.luogu.com.cn/problem/P3604

## 14. 洛谷 P3674 小清新人渣的本愿

### 题目描述
给定一个长度为n的数组arr，有m次查询。
每次查询[l,r]区间内，是否存在两个数的差等于给定值a，或者两个数的和等于给定值b，或者两个数的积等于给定值c。

### 输入格式
第一行两个整数n, m
第二行n个整数表示数组arr
接下来m行，每行四个整数opt, l, r, v表示查询类型和参数

### 输出格式
对于每个查询，输出一行"hana"或"bi"表示是否存在满足条件的两个数

### 数据范围
1 <= n, m <= 100000
1 <= arr[i] <= 100000

### 题目链接
https://www.luogu.com.cn/problem/P3674

## 15. 洛谷 P4396 [AHOI2013] 作业

### 题目描述
给定一个长度为n的数组arr，有m次查询。
每次查询[l,r]区间内，数值在[a,b]范围内的不同数字个数和这些数字出现次数之和。

### 输入格式
第一行两个整数n, m
第二行n个整数表示数组arr
接下来m行，每行四个整数l, r, a, b表示查询区间和数值范围

### 输出格式
对于每个查询，输出一行两个整数表示不同数字个数和出现次数之和

### 数据范围
1 <= n, m <= 100000
1 <= arr[i] <= 100000

### 题目链接
https://www.luogu.com.cn/problem/P4396

## 16. HDU 4638 Group

### 题目描述
有n个人，每个人都有一个唯一的ID(1..n)。ID为i和i-1的人是朋友，ID为i和i+1的人也是朋友。这些人站成一排。现在我们选择一个区间的人来分组。k个人在一组可以创造k*k的价值。一个区间的总价值是这些组价值的总和。同一组的人的ID必须是连续的。现在选择一个区间的人，想知道应该分成多少组才能使区间的总价值最大。

### 输入格式
第一行是T表示测试用例数。对于每个测试用例，第一行是n, m(1<=n ,m<=100000)表示有n个人和m个查询。然后一行有n个数字表示从左到右的人的ID。接下来m行每行有两个数字L,R(1<=L<=R<=n)，表示我们想知道[L,R]的答案。

### 输出格式
对于每个查询输出一个数字，表示应该分成多少组才能使总价值最大。

### 数据范围
1 <= n, m <= 100000
1 <= ID <= n
1 <= L <= R <= n

### 题目链接
http://acm.hdu.edu.cn/showproblem.php?pid=4638

## 17. 牛客网暑期ACM多校训练营 J Different Integers

### 题目描述
给定一个整数序列a1, a2, ..., an和q对整数(l1, r1), (l2, r2), ..., (lq, rq)，求count(l1, r1), count(l2, r2), ..., count(lq, rq)，其中count(i, j)是a1, a2, ..., ai, aj, aj+1, ..., an中不同整数的个数。

### 输入格式
输入由几个测试用例组成，以文件结束符终止。每个测试用例的第一行包含两个整数n和q。第二行包含n个整数a1, a2, ..., an。接下来的q行中第i行包含两个整数li和ri。

### 输出格式
对于每个测试用例，打印q个整数表示结果。

### 数据范围
1 ≤ n, q ≤ 10^5
1 ≤ ai ≤ n
1 ≤ li, ri ≤ n
测试用例数不超过10个

### 题目链接
https://www.nowcoder.com/acm/contest/139/J

## 18. POJ 2104 K-th Number

### 题目描述
给定一个数组a[1...n]和一系列问题Q(i, j, k)，对于每个问题Q(i, j, k)求在a[i...j]段中，如果这段被排序后，第k个数字是什么。

### 输入格式
第一行两个整数n和m，表示数组长度和查询次数。第二行n个整数表示数组元素。接下来m行，每行三个整数i, j, k表示查询。

### 输出格式
对于每个查询，输出一行一个整数表示答案。

### 数据范围
1 <= n <= 100000
1 <= m <= 5000

### 题目链接
http://poj.org/problem?id=2104

## 19. SPOJ MKTHNUM - K-th Number

### 题目描述
给定一个数组a[1...n]和一系列问题Q(i, j, k)，对于每个问题Q(i, j, k)求在a[i...j]段中，如果这段被排序后，第k个数字是什么。

### 输入格式
第一行两个整数n和m，表示数组长度和查询次数。第二行n个整数表示数组元素。接下来m行，每行三个整数i, j, k表示查询。

### 输出格式
对于每个查询，输出一行一个整数表示答案。

### 数据范围
1 <= n <= 100000
1 <= m <= 5000

### 题目链接
https://www.spoj.com/problems/MKTHNUM/

## 20. 洛谷 P3834 【模板】可持久化线段树 1（主席树）

### 题目描述
给定一个数组a[1...n]和一系列问题Q(i, j, k)，对于每个问题Q(i, j, k)求在a[i...j]段中，如果这段被排序后，第k个数字是什么。

### 输入格式
第一行两个整数n和m，表示数组长度和查询次数。第二行n个整数表示数组元素。接下来m行，每行三个整数i, j, k表示查询。

### 输出格式
对于每个查询，输出一行一个整数表示答案。

### 数据范围
1 <= n <= 100000
1 <= m <= 5000

### 题目链接
https://www.luogu.com.cn/problem/P3834

## 21. HDU 2665 Kth number

### 题目描述
给定一个数组a[1...n]和一系列问题Q(i, j, k)，对于每个问题Q(i, j, k)求在a[i...j]段中，如果这段被排序后，第k个数字是什么。

### 输入格式
第一行包含一个整数T，表示测试用例的数量。对于每个测试用例，第一行包含两个整数n和m。第二行包含n个整数。接下来m行，每行包含三个整数i, j, k。

### 输出格式
对于每个查询，输出一行一个整数表示答案。

### 数据范围
1 <= n <= 100000
1 <= m <= 5000

### 题目链接
http://acm.hdu.edu.cn/showproblem.php?pid=2665

## 22. ZOJ 2112 Dynamic Rankings

### 题目描述
给定一个数组a[1...n]，支持两种操作：1. 查询区间[i,j]中第k小的数；2. 修改位置i的值为t。

### 输入格式
第一行包含一个整数T，表示测试用例的数量。对于每个测试用例，第一行包含两个整数n和m。第二行包含n个整数。接下来m行，每行表示一个操作。

### 输出格式
对于每个查询操作，输出一行一个整数表示答案。

### 数据范围
1 <= n <= 50000
1 <= m <= 10000

### 题目链接
http://acm.zju.edu.cn/onlinejudge/showProblem.do?problemCode=2112

## 23. Codeforces 86D Powerful array

### 题目描述
给定一个数组a[1...n]，有m次查询。每次查询[l,r]区间内，每种数字出现次数的平方和乘以该数字的值的总和。

### 输入格式
第一行两个整数n和m，表示数组长度和查询次数。第二行n个整数表示数组元素。接下来m行，每行两个整数l, r表示查询区间。

### 输出格式
对于每个查询，输出一行一个整数表示答案。

### 数据范围
1 <= n, m <= 200000
1 <= a[i] <= 10^6

### 题目链接
https://codeforces.com/problemset/problem/86/D

## 24. Codeforces 220B Little Elephant and Array

### 题目描述
给定一个数组a[1...n]，有m次查询。每次查询[l,r]区间内，有多少个数字恰好出现了该数字的值那么多次。

### 输入格式
第一行两个整数n和m，表示数组长度和查询次数。第二行n个整数表示数组元素。接下来m行，每行两个整数l, r表示查询区间。

### 输出格式
对于每个查询，输出一行一个整数表示答案。

### 数据范围
1 <= n, m <= 100000
1 <= a[i] <= 10^9

### 题目链接
https://codeforces.com/problemset/problem/220/B

## 25. Codeforces 375D Tree and Queries

### 题目描述
给定一棵树，每个节点有一个颜色。有m次查询，每次查询以u为根的子树中，有多少种颜色恰好出现了至少k次。

### 输入格式
第一行两个整数n和m，表示节点数和查询次数。第二行n个整数表示每个节点的颜色。接下来n-1行，每行两个整数u, v表示树的边。接下来m行，每行两个整数u, k表示查询。

### 输出格式
对于每个查询，输出一行一个整数表示答案。

### 数据范围
1 <= n, m <= 100000
1 <= 颜色值 <= 10^5

### 题目链接
https://codeforces.com/problemset/problem/375/D

## 总结

莫队算法及其扩展形式（带修莫队、回滚莫队、树上莫队、二次离线莫队）是处理区间查询问题的重要工具。通过合理运用这些算法，可以解决各种复杂的区间统计问题。在实际应用中，需要根据具体问题选择合适的莫队变体，并结合其他数据结构进行优化。