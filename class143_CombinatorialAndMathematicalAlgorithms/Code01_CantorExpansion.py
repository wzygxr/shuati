# åº·æ‰˜å±•å¼€ç®—æ³•å®ç° (Pythonç‰ˆæœ¬)
# ç”¨äºè®¡ç®—ä¸€ä¸ªæ’åˆ—åœ¨æ‰€æœ‰å¯èƒ½æ’åˆ—ä¸­çš„å­—å…¸åºæ’åï¼Œä»¥åŠæ ¹æ®æ’åæ¢å¤æ’åˆ—
# ä½¿ç”¨æ ‘çŠ¶æ•°ç»„ï¼ˆBinary Indexed Treeï¼‰ä¼˜åŒ–ï¼Œå®ç°O(n log n)çš„æ—¶é—´å¤æ‚åº¦
# æ”¯æŒå¤§è§„æ¨¡æ•°æ®å¤„ç†ï¼Œé€‚ç”¨äºç«èµ›å’Œå·¥ç¨‹åœºæ™¯

'''
ç›¸å…³é¢˜ç›®åŠåº”ç”¨:
1. LeetCode 60. Permutation Sequence (æ’åˆ—åºåˆ—)
   é“¾æ¥: https://leetcode.cn/problems/permutation-sequence/
   æè¿°: ç»™å®šnå’Œkï¼Œè¿”å›ç¬¬kä¸ªæ’åˆ—
   è§£æ³•: ä½¿ç”¨åº·æ‰˜é€†å±•å¼€ï¼Œç›´æ¥è®¡ç®—ç¬¬kä¸ªæ’åˆ—
 
2. Luogu P5367 [æ¨¡æ¿]åº·æ‰˜å±•å¼€
   é“¾æ¥: https://www.luogu.com.cn/problem/P5367
   æè¿°: æ±‚æ’åˆ—åœ¨æ‰€æœ‰æ’åˆ—ä¸­çš„å­—å…¸åºæ’å
   è§£æ³•: æ ‡å‡†åº·æ‰˜å±•å¼€
 
3. POJ 3370 Halloween Treats
   é“¾æ¥: http://poj.org/problem?id=3370
   æè¿°: ä½¿ç”¨é¸½å·¢åŸç†è§£å†³é—®é¢˜ï¼Œåº·æ‰˜å±•å¼€ç”¨äºçŠ¶æ€å‹ç¼©
 
4. HDU 1027 Ignatius and the Princess II
   é“¾æ¥: http://acm.hdu.edu.cn/showproblem.php?pid=1027
   æè¿°: æ‰¾å‡ºç¬¬kä¸ªæ’åˆ—
   è§£æ³•: ä½¿ç”¨åº·æ‰˜é€†å±•å¼€
 
5. Luogu P1379 å…«æ•°ç éš¾é¢˜
   é“¾æ¥: https://www.luogu.com.cn/problem/P1379
   æè¿°: æ±‚è§£å…«æ•°ç æœ€çŸ­è·¯å¾„é—®é¢˜
   è§£æ³•: ä½¿ç”¨åº·æ‰˜å±•å¼€è¿›è¡ŒçŠ¶æ€å‹ç¼©ï¼Œé…åˆBFS
 
6. Codeforces 501D Misha and Permutations Summation
   é“¾æ¥: https://codeforces.com/problemset/problem/501/D
   æè¿°: è®¡ç®—ä¸¤ä¸ªæ’åˆ—åºå·ä¹‹å’Œå¯¹åº”çš„æ’åˆ—
   è§£æ³•: åº·æ‰˜å±•å¼€è½¬æ•°å­—ï¼Œç›¸åŠ åé€†å±•å¼€
 
7. æ•°æ®å‹ç¼©ä¸å“ˆå¸Œè¡¨æ„å»º
   åº·æ‰˜å±•å¼€å¯å°†n!ç§æ’åˆ—æ˜ å°„ä¸º0åˆ°n!-1çš„æ•´æ•°ï¼Œå¤§å¤§èŠ‚çœå­˜å‚¨ç©ºé—´
   ç‰¹åˆ«é€‚ç”¨äºæ’åˆ—ç›¸å…³ç®—æ³•çš„çŠ¶æ€è¡¨ç¤º
'''

MOD = 998244353

class BIT:
    """æ ‘çŠ¶æ•°ç»„ï¼ˆBinary Indexed Treeï¼‰å®ç°ï¼Œæ”¯æŒé«˜æ•ˆçš„å‰ç¼€å’ŒæŸ¥è¯¢å’Œå•ç‚¹æ›´æ–°
    
    ç”¨äºåº·æ‰˜å±•å¼€ä¸­è®¡ç®—æ¯”å½“å‰å…ƒç´ å°ä¸”æœªä½¿ç”¨çš„å…ƒç´ ä¸ªæ•°ï¼Œå°†æ—¶é—´å¤æ‚åº¦ä»O(n)ä¼˜åŒ–åˆ°O(log n)
    """
    def __init__(self, n, mod=MOD):
        self.n = n
        self.mod = mod
        self.tree = [0] * (n + 2)  # é¢„ç•™é¢å¤–ç©ºé—´é˜²æ­¢è¶Šç•Œ
    
    def lowbit(self, x):
        """è®¡ç®—xçš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­æœ€ä½ä½1æ‰€å¯¹åº”çš„å€¼
        
        Args:
            x: æ•´æ•°
            
        Returns:
            xçš„äºŒè¿›åˆ¶ä¸­æœ€ä½ä½1å¯¹åº”çš„å€¼
        """
        return x & (-x)
    
    def add(self, x, val):
        """åœ¨ä½ç½®xæ·»åŠ valå€¼ï¼Œå¹¶å¯¹ç»“æœè¿›è¡Œæ¨¡è¿ç®—å¤„ç†
        
        Args:
            x: è¦æ›´æ–°çš„ä½ç½®
            val: è¦æ·»åŠ çš„å€¼ï¼ˆé€šå¸¸ä¸º1è¡¨ç¤ºå¯ç”¨ï¼Œ-1è¡¨ç¤ºå·²ä½¿ç”¨ï¼‰
        """
        while x <= self.n:
            self.tree[x] = (self.tree[x] + val) % self.mod
            # å¤„ç†è´Ÿæ•°æƒ…å†µï¼Œç¡®ä¿æ¨¡è¿ç®—ç»“æœä¸ºæ­£æ•°
            if self.tree[x] < 0:
                self.tree[x] += self.mod
            x += self.lowbit(x)
    
    def sum(self, x):
        """è®¡ç®—å‰xä¸ªå…ƒç´ çš„å’Œï¼Œç»“æœå¯¹modå–æ¨¡
        
        Args:
            x: æŸ¥è¯¢çš„ä¸Šç•Œ
            
        Returns:
            å‰xä¸ªå…ƒç´ çš„å’Œï¼ˆæ¨¡modåçš„å€¼ï¼‰
        """
        ret = 0
        x = min(x, self.n)  # é˜²æ­¢xè¶…è¿‡nå¯¼è‡´è¶Šç•Œ
        while x > 0:
            ret = (ret + self.tree[x]) % self.mod
            x -= self.lowbit(x)
        return ret

'''
åº·æ‰˜å±•å¼€ç®—æ³•
æ—¶é—´å¤æ‚åº¦: O(n log n) - ä½¿ç”¨æ ‘çŠ¶æ•°ç»„ä¼˜åŒ–
ç©ºé—´å¤æ‚åº¦: O(n)

ç®—æ³•åŸç†:
åº·æ‰˜å±•å¼€æ˜¯ä¸€ä¸ªå…¨æ’åˆ—åˆ°è‡ªç„¶æ•°çš„åŒå°„ï¼Œå¸¸ç”¨äºæ„å»ºå“ˆå¸Œè¡¨æ—¶çš„ç©ºé—´å‹ç¼©ã€‚
åº·æ‰˜å±•å¼€çš„å®è´¨æ˜¯è®¡ç®—å½“å‰æ’åˆ—åœ¨æ‰€æœ‰ç”±å°åˆ°å¤§å…¨æ’åˆ—ä¸­çš„é¡ºåºã€‚

å…¬å¼:
X = a[n]*(n-1)! + a[n-1]*(n-2)! + ... + a[1]*0!
å…¶ä¸­ï¼Œa[i]ä¸ºæ•´æ•°ï¼Œå¹¶ä¸”0 <= a[i] < iï¼Œè¡¨ç¤ºåœ¨ç¬¬iä½ä¹‹å‰ï¼Œæœ‰å¤šå°‘ä¸ªæ•°å°äºå½“å‰ä½çš„æ•°

ä¸¾ä¾‹:
å¯¹äºæ’åˆ— {3, 4, 1, 5, 2}ï¼Œè®¡ç®—å…¶åº·æ‰˜å±•å¼€å€¼:
ç¬¬1ä½æ˜¯3ï¼Œæ¯”3å°çš„æ•°æœ‰2ä¸ª(1,2)ï¼Œæ‰€ä»¥ a[5] = 2
ç¬¬2ä½æ˜¯4ï¼Œæ¯”4å°çš„æ•°æœ‰2ä¸ª(1,2ï¼Œä½†3å·²è¢«ä½¿ç”¨)ï¼Œæ‰€ä»¥ a[4] = 2
ç¬¬3ä½æ˜¯1ï¼Œæ¯”1å°çš„æ•°æœ‰0ä¸ªï¼Œæ‰€ä»¥ a[3] = 0
ç¬¬4ä½æ˜¯5ï¼Œæ¯”5å°çš„æ•°æœ‰1ä¸ª(1,2,3,4ä¸­åªå‰©ä¸‹2)ï¼Œæ‰€ä»¥ a[2] = 1
ç¬¬5ä½æ˜¯2ï¼Œæ¯”2å°çš„æ•°æœ‰0ä¸ªï¼Œæ‰€ä»¥ a[1] = 0

å› æ­¤ï¼ŒX = 2*4! + 2*3! + 0*2! + 1*1! + 0*0! = 48 + 12 + 0 + 1 + 0 = 61

æ³¨æ„: ç”±äºé¢˜ç›®è¦æ±‚æ’åä»1å¼€å§‹ï¼Œè€Œåº·æ‰˜å±•å¼€ä»0å¼€å§‹ï¼Œæ‰€ä»¥æœ€åè¦+1
'''
def cantor_expansion(n, arr, mod=998244353):
    """
    åº·æ‰˜å±•å¼€ï¼šå°†ä¸€ä¸ªæ’åˆ—è½¬æ¢ä¸ºå…¶å­—å…¸åºæ’åï¼ˆä»0å¼€å§‹ï¼‰
    
    æ•°å­¦åŸç†:
    åº·æ‰˜å±•å¼€æ˜¯ä¸€ä¸ªå…¨æ’åˆ—åˆ°è‡ªç„¶æ•°çš„åŒå°„å‡½æ•°ï¼Œå°†nä¸ªå…ƒç´ çš„æ’åˆ—æ˜ å°„åˆ°å”¯ä¸€çš„è‡ªç„¶æ•°ã€‚
    æ˜ å°„å…¬å¼: X = a[n]*(n-1)! + a[n-1]*(n-2)! + ... + a[1]*0!
    å…¶ä¸­ï¼Œa[i]è¡¨ç¤ºåœ¨ç¬¬iä½ä¹‹å‰ä¸”æ¯”ç¬¬iä½å…ƒç´ å°çš„æœªä½¿ç”¨å…ƒç´ ä¸ªæ•°
    
    ä¼˜åŒ–ç­–ç•¥:
    1. ä½¿ç”¨æ ‘çŠ¶æ•°ç»„é«˜æ•ˆæŸ¥è¯¢å‰ç¼€å’Œï¼Œé¿å…O(n)æ—¶é—´å¤æ‚åº¦çš„çº¿æ€§æ‰«æ
    2. é¢„å¤„ç†é˜¶ä¹˜æ•°ç»„ï¼Œé¿å…é‡å¤è®¡ç®—
    3. ä½¿ç”¨æ¨¡è¿ç®—é˜²æ­¢æ•°å€¼æº¢å‡º
    
    Args:
        n: æ’åˆ—é•¿åº¦
        arr: æ’åˆ—æ•°ç»„ï¼Œå…ƒç´ æ˜¯1~nçš„æ’åˆ—
        mod: æ¨¡æ•°ï¼Œç”¨äºå¤§æ•°è¿ç®—
    
    Returns:
        æ’åˆ—çš„åº·æ‰˜å±•å¼€å€¼ï¼ˆå­—å…¸åºæ’å-1ï¼‰
    
    Raises:
        ValueError: å½“è¾“å…¥ä¸æ˜¯æœ‰æ•ˆçš„æ’åˆ—æ—¶æŠ›å‡º
    """
    # éªŒè¯è¾“å…¥æ˜¯å¦ä¸ºæœ‰æ•ˆçš„æ’åˆ—
    if len(arr) != n:
        raise ValueError(f"è¾“å…¥æ’åˆ—é•¿åº¦åº”ä¸º{n}ï¼Œå®é™…ä¸º{len(arr)}")
    if set(arr) != set(range(1, n+1)):
        raise ValueError(f"è¾“å…¥ä¸æ˜¯æœ‰æ•ˆçš„1~{n}æ’åˆ—ï¼ŒåŒ…å«é‡å¤æˆ–è¶…å‡ºèŒƒå›´çš„å…ƒç´ ")
    
    # è®¡ç®—é˜¶ä¹˜
    fac = [1] * (n + 1)
    for i in range(1, n + 1):
        fac[i] = (fac[i-1] * i) % mod
    
    # åˆå§‹åŒ–æ ‘çŠ¶æ•°ç»„
    bit = BIT(n, mod)
    for i in range(1, n + 1):
        bit.add(i, 1)
    
    # è®¡ç®—åº·æ‰˜å±•å¼€å€¼
    ans = 0
    for i in range(n):
        # è®¡ç®—æ¯”arr[i]å°ä¸”æœªè¢«ä½¿ç”¨çš„æ•°çš„ä¸ªæ•°
        cnt = bit.sum(arr[i] - 1)
        ans = (ans + cnt * fac[n-1-i]) % mod
        # å°†arr[i]æ ‡è®°ä¸ºå·²ä½¿ç”¨
        bit.add(arr[i], -1)
    
    return ans

def inverse_cantor_expansion(n, rank, mod=998244353):
    """
    åº·æ‰˜é€†å±•å¼€ï¼šæ ¹æ®æ’åæ„é€ æ’åˆ—
    
    æ—¶é—´å¤æ‚åº¦: O(n^2) - ç”±äºåˆ—è¡¨åˆ é™¤æ“ä½œ
    ç©ºé—´å¤æ‚åº¦: O(n)
    
    ç®—æ³•åŸç†:
    é€†åº·æ‰˜å±•å¼€ä»æ’åå‡ºå‘ï¼Œé€æ­¥ç¡®å®šæ’åˆ—ä¸­çš„æ¯ä¸ªä½ç½®å…ƒç´ ã€‚
    é€šè¿‡é˜¶ä¹˜çš„é™¤æ³•å’Œå–æ¨¡è¿ç®—ï¼Œç¡®å®šæ¯ä¸ªä½ç½®åº”è¯¥é€‰æ‹©ç¬¬å‡ ä¸ªå¯ç”¨å…ƒç´ ã€‚
    
    å®ç°æ€è·¯:
    1. é¢„å¤„ç†é˜¶ä¹˜æ•°ç»„
    2. åˆå§‹åŒ–å¯ç”¨æ•°å­—é›†åˆ
    3. å¯¹æ¯ä¸ªä½ç½®iï¼ˆä»é«˜ä½åˆ°ä½ä½ï¼‰ï¼Œè®¡ç®—k = rank / (n-i-1)!
    4. åœ¨å¯ç”¨æ•°å­—ä¸­é€‰æ‹©ç¬¬kå°çš„æ•°å­—æ”¾å…¥ç»“æœ
    5. ä»å¯ç”¨æ•°å­—ä¸­ç§»é™¤è¯¥æ•°å­—ï¼Œæ›´æ–°rank = rank % (n-i-1)!
    
    Args:
        n: æ’åˆ—é•¿åº¦
        rank: æ’åˆ—çš„æ’åï¼ˆä»0å¼€å§‹ï¼‰
        mod: æ¨¡æ•°ï¼Œç”¨äºå¤§æ•°è¿ç®—
    
    Returns:
        å¯¹åº”çš„æ’åˆ—æ•°ç»„
    
    Raises:
        ValueError: å½“æ’åè¶…å‡ºæœ‰æ•ˆèŒƒå›´æ—¶æŠ›å‡º
    """
    # éªŒè¯æ’åçš„æœ‰æ•ˆæ€§
    if rank < 0:
        raise ValueError("æ’åä¸èƒ½ä¸ºè´Ÿæ•°")
    
    # è®¡ç®—æœ€å¤§å¯èƒ½æ’å
    max_rank = 1
    for i in range(1, n+1):
        max_rank *= i
        if max_rank > 10**18:  # é˜²æ­¢è¿‡å¤§çš„nå¯¼è‡´æº¢å‡º
            break
    
    if n <= 20 and rank >= max_rank:  # åªåœ¨nè¾ƒå°æ—¶æ£€æŸ¥èŒƒå›´
        raise ValueError(f"å¯¹äºn={n}ï¼Œæ’åä¸èƒ½è¶…è¿‡{n}!-1 = {max_rank-1}")
    
    # è®¡ç®—é˜¶ä¹˜
    fac = [1] * (n + 1)
    for i in range(1, n + 1):
        fac[i] = (fac[i-1] * i) % mod
    
    # åˆå§‹åŒ–å¯ç”¨æ•°å­—é›†åˆ
    available = list(range(1, n + 1))
    result = []
    
    # æ„é€ æ’åˆ—
    for i in range(n - 1, -1, -1):
        # è®¡ç®—å½“å‰ä½ç½®åº”è¯¥é€‰æ‹©ç¬¬å‡ ä¸ªå¯ç”¨æ•°å­—
        index = rank // fac[i]
        rank = rank % fac[i]
        
        # é€‰æ‹©å¹¶æ·»åŠ åˆ°ç»“æœ
        result.append(available[index])
        # ä»å¯ç”¨æ•°å­—ä¸­ç§»é™¤
        del available[index]
    
    return result

def run_performance_test():
    """
    è¿è¡Œæ€§èƒ½æµ‹è¯•ï¼Œæ¯”è¾ƒä¸åŒå¤§å°æ’åˆ—çš„åº·æ‰˜å±•å¼€å’Œé€†å±•å¼€æ€§èƒ½
    """
    import time
    import random
    
    print("å¼€å§‹æ€§èƒ½æµ‹è¯•...")
    print("======================")
    
    sizes = [1000, 5000, 10000]  # Pythonä¸­å¯ä»¥æµ‹è¯•çš„åˆç†å¤§å°
    
    for size in sizes:
        try:
            # ç”Ÿæˆéšæœºæ’åˆ—
            permutation = list(range(1, size + 1))
            random.shuffle(permutation)
            
            # æµ‹è¯•åº·æ‰˜å±•å¼€æ€§èƒ½
            start_time = time.time()
            rank = cantor_expansion(size, permutation)
            expansion_time = (time.time() - start_time) * 1000  # è½¬æ¢ä¸ºæ¯«ç§’
            
            print(f"æ’åˆ—é•¿åº¦ {size}:")
            print(f"  åº·æ‰˜å±•å¼€è€—æ—¶: {expansion_time:.3f} æ¯«ç§’")
            
            # æµ‹è¯•é€†å±•å¼€æ€§èƒ½ï¼ˆä»…å¯¹å°æ•°æ®é‡ï¼‰
            if size <= 5000:  # å¤§æ•°æ®é‡æ—¶è·³è¿‡é€†å±•å¼€æµ‹è¯•
                start_time = time.time()
                reconstructed = inverse_cantor_expansion(size, rank)
                inverse_time = (time.time() - start_time) * 1000  # è½¬æ¢ä¸ºæ¯«ç§’
                
                # éªŒè¯é‡å»ºæ˜¯å¦æ­£ç¡®
                is_correct = permutation == reconstructed
                print(f"  é€†åº·æ‰˜å±•å¼€è€—æ—¶: {inverse_time:.3f} æ¯«ç§’")
                print(f"  é‡å»ºæ­£ç¡®æ€§: {'âœ“' if is_correct else 'âœ—'}")
            else:
                print("  é€†åº·æ‰˜å±•å¼€: è·³è¿‡å¤§æ•°æ®é‡æµ‹è¯•")
        
        except Exception as e:
            print(f"æµ‹è¯•å¤§å° {size} æ—¶å‡ºé”™: {str(e)}")
    
    print("======================")

# æµ‹è¯•å‡½æ•°
def test():
    """
    è¿è¡Œå•å…ƒæµ‹è¯•ï¼ŒéªŒè¯åº·æ‰˜å±•å¼€å’Œé€†å±•å¼€çš„æ­£ç¡®æ€§
    
    æµ‹è¯•åœºæ™¯åŒ…æ‹¬ï¼š
    1. åŸºç¡€æ’åˆ—æµ‹è¯•
    2. è¾¹ç•Œæƒ…å†µæµ‹è¯•
    3. å¼‚å¸¸è¾“å…¥æµ‹è¯•
    
    Returns:
        bool: æ‰€æœ‰æµ‹è¯•æ˜¯å¦é€šè¿‡
    """
    test_cases = [
        [3, [1, 2, 3], 0],  # æœ€å°æ’åˆ—
        [3, [1, 3, 2], 1],
        [3, [2, 1, 3], 2],
        [3, [2, 3, 1], 3],
        [3, [3, 1, 2], 4],
        [3, [3, 2, 1], 5],  # æœ€å¤§æ’åˆ—
        [5, [3, 4, 1, 5, 2], 60]  # å¤æ‚æ’åˆ—
    ]
    
    print("å¼€å§‹è¿è¡Œå•å…ƒæµ‹è¯•...")
    print("======================")
    
    # åŸºç¡€æµ‹è¯•
    for n, perm, expected in test_cases:
        # æµ‹è¯•åº·æ‰˜å±•å¼€
        actual = cantor_expansion(n, perm)
        if actual != expected:
            print(f"âŒ åº·æ‰˜å±•å¼€æµ‹è¯•å¤±è´¥! æ’åˆ— {perm}, æœŸæœ› {expected}, å®é™… {actual}")
            return False
        else:
            print(f"âœ… åº·æ‰˜å±•å¼€æµ‹è¯•é€šè¿‡: æ’åˆ— {perm} -> æ’å {actual}")
        
        # æµ‹è¯•åº·æ‰˜é€†å±•å¼€
        recovered = inverse_cantor_expansion(n, expected)
        if recovered != perm:
            print(f"âŒ åº·æ‰˜é€†å±•å¼€æµ‹è¯•å¤±è´¥! æ’å {expected}, æœŸæœ› {perm}, å®é™… {recovered}")
            return False
        else:
            print(f"âœ… åº·æ‰˜é€†å±•å¼€æµ‹è¯•é€šè¿‡: æ’å {expected} -> æ’åˆ— {recovered}")
    
    # è¾¹ç•Œæƒ…å†µæµ‹è¯•
    print("\nè¿è¡Œè¾¹ç•Œæƒ…å†µæµ‹è¯•...")
    # n=1 æƒ…å†µ
    n=1
    perm=[1]
    expected=0
    actual = cantor_expansion(n, perm)
    recovered = inverse_cantor_expansion(n, expected)
    if actual != expected or recovered != perm:
        print(f"âŒ è¾¹ç•Œæµ‹è¯•å¤±è´¥: n=1")
        return False
    else:
        print(f"âœ… è¾¹ç•Œæµ‹è¯•é€šè¿‡: n=1")
    
    # å¼‚å¸¸è¾“å…¥æµ‹è¯•
    print("\nè¿è¡Œå¼‚å¸¸è¾“å…¥æµ‹è¯•...")
    try:
        # æ— æ•ˆæ’åˆ—æµ‹è¯•
        cantor_expansion(3, [1, 1, 2])
        print("âŒ å¼‚å¸¸æµ‹è¯•å¤±è´¥: åº”æ£€æµ‹åˆ°æ— æ•ˆæ’åˆ—")
        return False
    except ValueError as e:
        print(f"âœ… å¼‚å¸¸æµ‹è¯•é€šè¿‡: æ­£ç¡®æ£€æµ‹åˆ°æ— æ•ˆæ’åˆ—: {str(e)}")
    
    try:
        # æ— æ•ˆæ’åæµ‹è¯•
        inverse_cantor_expansion(3, 6)  # 3! = 6ï¼Œæ’ååº”å°äº6
        print("âŒ å¼‚å¸¸æµ‹è¯•å¤±è´¥: åº”æ£€æµ‹åˆ°æ— æ•ˆæ’å")
        return False
    except ValueError as e:
        print(f"âœ… å¼‚å¸¸æµ‹è¯•é€šè¿‡: æ­£ç¡®æ£€æµ‹åˆ°æ— æ•ˆæ’å: {str(e)}")
    
    print("\n======================")
    print("ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡!")
    return True

# ç”¨æˆ·äº¤äº’ç•Œé¢
def interactive_mode():
    """
    äº¤äº’å¼ç•Œé¢ï¼Œå…è®¸ç”¨æˆ·è¾“å…¥æ’åˆ—æˆ–æ’åè¿›è¡Œè½¬æ¢
    
    åŠŸèƒ½åŒ…æ‹¬ï¼š
    1. è®¡ç®—æ’åˆ—çš„æ’åï¼ˆåº·æ‰˜å±•å¼€ï¼‰
    2. æ ¹æ®æ’åç”Ÿæˆæ’åˆ—ï¼ˆåº·æ‰˜é€†å±•å¼€ï¼‰
    3. è¿è¡Œå•å…ƒæµ‹è¯•
    4. è¿è¡Œæ€§èƒ½æµ‹è¯•
    5. æ˜¾ç¤ºç®—æ³•è¯´æ˜
    6. é€€å‡ºç¨‹åº
    """
    print("=== åº·æ‰˜å±•å¼€ä¸é€†å±•å¼€è®¡ç®—å™¨ ===")
    print("åº·æ‰˜å±•å¼€æ˜¯ä¸€ç§å°†å…¨æ’åˆ—æ˜ å°„ä¸ºå”¯ä¸€è‡ªç„¶æ•°çš„ç®—æ³•")
    print("æ”¯æŒå°†æ’åˆ—è½¬æ¢ä¸ºæ’åï¼Œæˆ–å°†æ’åè½¬æ¢ä¸ºæ’åˆ—")
    print()
    
    while True:
        print("è¯·é€‰æ‹©æ“ä½œï¼š")
        print("1. è®¡ç®—æ’åˆ—çš„æ’åï¼ˆåº·æ‰˜å±•å¼€ï¼‰")
        print("2. æ ¹æ®æ’åç”Ÿæˆæ’åˆ—ï¼ˆåº·æ‰˜é€†å±•å¼€ï¼‰")
        print("3. è¿è¡Œå•å…ƒæµ‹è¯•")
        print("4. è¿è¡Œæ€§èƒ½æµ‹è¯•")
        print("5. æ˜¾ç¤ºç®—æ³•è¯´æ˜")
        print("6. é€€å‡º")
        
        choice = input("è¯·è¾“å…¥é€‰æ‹©(1-6): ")
        
        if choice == '1':
            try:
                n = int(input("è¯·è¾“å…¥æ’åˆ—é•¿åº¦n: "))
                arr_str = input(f"è¯·è¾“å…¥1-{n}çš„æ’åˆ—ï¼Œç”¨ç©ºæ ¼åˆ†éš”: ")
                arr = list(map(int, arr_str.split()))
                
                # è®¡ç®—åº·æ‰˜å±•å¼€å€¼ï¼ˆæ’å-1ï¼‰
                rank = cantor_expansion(n, arr)
                print(f"æ’åˆ—çš„å­—å…¸åºæ’åï¼ˆä»1å¼€å§‹ï¼‰: {rank + 1}")
                print(f"åº·æ‰˜å±•å¼€å€¼ï¼ˆä»0å¼€å§‹ï¼‰: {rank}")
            except ValueError as e:
                print(f"è¾“å…¥é”™è¯¯: {str(e)}")
            except Exception as e:
                print(f"å‘ç”Ÿé”™è¯¯: {str(e)}")
        
        elif choice == '2':
            try:
                n = int(input("è¯·è¾“å…¥æ’åˆ—é•¿åº¦n: "))
                rank_input = input("è¯·è¾“å…¥æ’åæ–¹å¼ï¼ˆ1.ä»1å¼€å§‹ 2.ä»0å¼€å§‹ï¼‰: ")
                rank_val = int(input("è¯·è¾“å…¥æ’åå€¼: "))
                
                # è½¬æ¢ä¸ºä»0å¼€å§‹çš„æ’å
                if rank_input == '1':
                    rank_val -= 1
                    if rank_val < 0:
                        print("é”™è¯¯ï¼šæ’åå¿…é¡»å¤§äºç­‰äº1")
                        continue
                
                # è®¡ç®—é€†åº·æ‰˜å±•å¼€
                permutation = inverse_cantor_expansion(n, rank_val)
                print(f"å¯¹åº”çš„æ’åˆ—: {' '.join(map(str, permutation))}")
            except ValueError as e:
                print(f"è¾“å…¥é”™è¯¯: {str(e)}")
            except Exception as e:
                print(f"å‘ç”Ÿé”™è¯¯: {str(e)}")
        
        elif choice == '3':
            test()
        
        elif choice == '4':
            run_performance_test()
        
        elif choice == '5':
            show_algorithm_info()
        
        elif choice == '6':
            print("æ„Ÿè°¢ä½¿ç”¨ï¼Œå†è§!")
            break
        
        else:
            print("æ— æ•ˆé€‰æ‹©ï¼Œè¯·è¾“å…¥1-6ä¹‹é—´çš„æ•°å­—")
        
        print()  # æ‰“å°ç©ºè¡Œåˆ†éš”ä¸åŒæ“ä½œ

def show_algorithm_info():
    """
    æ˜¾ç¤ºåº·æ‰˜å±•å¼€ç®—æ³•çš„è¯¦ç»†è¯´æ˜
    """
    print("=== åº·æ‰˜å±•å¼€ç®—æ³•è¯´æ˜ ===")
    print()
    print("1. åº·æ‰˜å±•å¼€çš„æ•°å­¦åŸç†:")
    print("   - åº·æ‰˜å±•å¼€æ˜¯ä¸€ä¸ªå…¨æ’åˆ—åˆ°è‡ªç„¶æ•°çš„åŒå°„å‡½æ•°")
    print("   - å…¬å¼: X = a[n]*(n-1)! + a[n-1]*(n-2)! + ... + a[1]*0!")
    print("   - å…¶ä¸­a[i]è¡¨ç¤ºåœ¨ç¬¬iä½ä¹‹å‰ä¸”æ¯”ç¬¬iä½å…ƒç´ å°çš„æœªä½¿ç”¨å…ƒç´ ä¸ªæ•°")
    print()
    print("2. ç®—æ³•å¤æ‚åº¦:")
    print("   - åº·æ‰˜å±•å¼€: æ—¶é—´å¤æ‚åº¦ O(n log n) - ä½¿ç”¨æ ‘çŠ¶æ•°ç»„ä¼˜åŒ–")
    print("   - é€†åº·æ‰˜å±•å¼€: æ—¶é—´å¤æ‚åº¦ O(nÂ²) - ç”±äºåˆ é™¤æ“ä½œ")
    print("   - ç©ºé—´å¤æ‚åº¦: O(n)")
    print()
    print("3. åº”ç”¨åœºæ™¯:")
    print("   - æ’åˆ—ç´¢å¼•åŒ–å’Œå­˜å‚¨")
    print("   - çŠ¶æ€å‹ç¼©ï¼ˆå¦‚å…«æ•°ç é—®é¢˜ï¼‰")
    print("   - ç”Ÿæˆç¬¬kä¸ªæ’åˆ—")
    print("   - æ’åˆ—åŠ å¯†ä¸è§£å¯†")
    print()
    print("4. ä¼˜åŒ–æŠ€æœ¯:")
    print("   - ä½¿ç”¨æ ‘çŠ¶æ•°ç»„é«˜æ•ˆè®¡ç®—å‰ç¼€å’Œ")
    print("   - é¢„è®¡ç®—é˜¶ä¹˜æ•°ç»„é¿å…é‡å¤è®¡ç®—")
    print("   - æ¨¡è¿ç®—å¤„ç†å¤§æ•°")
    print()
    print("5. å®ç°æ³¨æ„äº‹é¡¹:")
    print("   - è¾“å…¥éªŒè¯é˜²æ­¢æ— æ•ˆæ’åˆ—")
    print("   - è¾¹ç•Œæ¡ä»¶å¤„ç†ï¼ˆn=1, ç©ºè¾“å…¥ç­‰ï¼‰")
    print("   - æ€§èƒ½ä¼˜åŒ–é¿å…è¶…æ—¶")
    print()

# ä¸»å‡½æ•°
if __name__ == "__main__":
    """
    ä¸»ç¨‹åºå…¥å£ï¼Œæ”¯æŒå‘½ä»¤è¡Œå‚æ•°å’Œäº¤äº’å¼è¾“å…¥
    
    å‘½ä»¤è¡Œå‚æ•°ï¼š
    --interactive: å¯åŠ¨äº¤äº’å¼æ¨¡å¼
    --test: è¿è¡Œå•å…ƒæµ‹è¯•
    --performance: è¿è¡Œæ€§èƒ½æµ‹è¯•
    æ— å‚æ•°æ—¶ï¼Œè¯»å–æ ‡å‡†è¾“å…¥è¿›è¡Œè®¡ç®—
    """
    import sys
    
    # å‘½ä»¤è¡Œå‚æ•°å¤„ç†
    if len(sys.argv) > 1:
        if sys.argv[1] == "--interactive":
            interactive_mode()
        elif sys.argv[1] == "--test":
            test()
        elif sys.argv[1] == "--performance":
            run_performance_test()
        else:
            print(f"æœªçŸ¥å‚æ•°: {sys.argv[1]}")
            print("å¯ç”¨å‚æ•°:")
            print("  --interactive: å¯åŠ¨äº¤äº’å¼æ¨¡å¼")
            print("  --test: è¿è¡Œå•å…ƒæµ‹è¯•")
            print("  --performance: è¿è¡Œæ€§èƒ½æµ‹è¯•")
    else:
        # ä¿æŒåŸæœ‰åŠŸèƒ½ï¼Œæ”¯æŒæ ‡å‡†è¾“å…¥è¾“å‡º
        try:
            n = int(input())
            arr = list(map(int, input().split()))
            # è®¡ç®—æ’åï¼ˆä»1å¼€å§‹ï¼‰
            result = (cantor_expansion(n, arr) + 1) % MOD
            print(result)
        except EOFError:
            # å¦‚æœæ²¡æœ‰è¾“å…¥ï¼Œå¯åŠ¨äº¤äº’æ¨¡å¼
            interactive_mode()
        except Exception as e:
            print(f"é”™è¯¯: {str(e)}")
            # é”™è¯¯æ—¶å¯åŠ¨äº¤äº’æ¨¡å¼
            try:
                import traceback
                traceback.print_exc()
            except:
                pass
            interactive_mode()