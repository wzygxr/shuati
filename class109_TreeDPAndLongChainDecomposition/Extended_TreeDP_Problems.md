# 树形DP与长链剖分扩展题目集

## 新增题目列表

### 1. LeetCode 543. 二叉树的直径
- **题目描述**: 给定一棵二叉树，计算它的直径长度。二叉树的直径是任意两个节点路径长度中的最大值。
- **解题思路**: 树形DP，计算每个节点的左右子树深度，直径 = 左子树深度 + 右子树深度
- **时间复杂度**: O(n)
- **空间复杂度**: O(h)，h为树的高度
- **最优解**: 是
- **题目链接**: https://leetcode.cn/problems/diameter-of-binary-tree/

### 2. LeetCode 124. 二叉树中的最大路径和
- **题目描述**: 给定一棵二叉树，找到路径（从任意节点出发，到达任意节点）的最大和。
- **解题思路**: 树形DP，维护每个节点的最大贡献值，路径和 = 左子树贡献 + 右子树贡献 + 节点值
- **时间复杂度**: O(n)
- **空间复杂度**: O(h)
- **最优解**: 是
- **题目链接**: https://leetcode.cn/problems/binary-tree-maximum-path-sum/

### 3. Codeforces 1092F. Tree with Maximum Cost
- **题目描述**: 给定一棵树，每个节点有权值，选择一个根节点使得Σ(权值×距离)最大。
- **解题思路**: 换根DP，通过两次DFS计算每个节点作为根时的总代价
- **时间复杂度**: O(n)
- **空间复杂度**: O(n)
- **最优解**: 是
- **题目链接**: https://codeforces.com/contest/1092/problem/F

### 4. Luogu P1352 没有上司的舞会
- **题目描述**: 公司有n个人，每个人有一个快乐值，不能同时邀请上司和下属，求最大快乐值。
- **解题思路**: 经典树形DP，dp[u][0/1]表示选/不选节点u时的最大快乐值
- **时间复杂度**: O(n)
- **空间复杂度**: O(n)
- **最优解**: 是
- **题目链接**: https://www.luogu.com.cn/problem/P1352

### 5. LeetCode 337. 打家劫舍 III
- **题目描述**: 小偷发现了一个新的可行窃的地区，这个地区只有一个入口，我们称之为根。除了根之外，每栋房子有且只有一个父房子与之相连。
- **解题思路**: 树形DP，类似没有上司的舞会问题
- **时间复杂度**: O(n)
- **空间复杂度**: O(h)
- **最优解**: 是
- **题目链接**: https://leetcode.cn/problems/house-robber-iii/

### 6. Codeforces 1324F. Maximum White Subtree
- **题目描述**: 给定一棵树，每个节点是黑色或白色，求每个节点所在连通分量中白色节点数-黑色节点数的最大值。
- **解题思路**: 树形DP + 换根DP
- **时间复杂度**: O(n)
- **空间复杂度**: O(n)
- **最优解**: 是
- **题目链接**: https://codeforces.com/contest/1324/problem/F

### 7. LeetCode 968. 监控二叉树
- **题目描述**: 给定一个二叉树，我们在树的节点上安装摄像头。节点上的每个摄影头都可以监视其父对象、自身及其直接子对象。计算监控树的所有节点所需的最小摄像头数量。
- **解题思路**: 树形DP，状态设计复杂
- **时间复杂度**: O(n)
- **空间复杂度**: O(h)
- **最优解**: 是
- **题目链接**: https://leetcode.cn/problems/binary-tree-cameras/

### 8. Luogu P2014 [CTSC1997] 选课
- **题目描述**: 大学实行学分制，每门课都有一定的学分，学生必须选修一定的课程才能毕业。有些课程有先修课。
- **解题思路**: 树形背包DP
- **时间复杂度**: O(n×m)
- **空间复杂度**: O(n×m)
- **最优解**: 是
- **题目链接**: https://www.luogu.com.cn/problem/P2014

### 9. LeetCode 1372. 二叉树中的最长交错路径
- **题目描述**: 给定一棵二叉树，找到树中最长的交错路径。交错路径定义为：路径中相邻节点交替为左子节点和右子节点。
- **解题思路**: 树形DP，维护左右方向的最长路径
- **时间复杂度**: O(n)
- **空间复杂度**: O(h)
- **最优解**: 是
- **题目链接**: https://leetcode.cn/problems/longest-zigzag-path-in-a-binary-tree/

### 10. Codeforces 161D. Distance in Tree
- **题目描述**: 给定一棵树，求距离恰好为k的点对数量。
- **解题思路**: 长链剖分优化树形DP
- **时间复杂度**: O(n)
- **空间复杂度**: O(n)
- **最优解**: 是
- **题目链接**: https://codeforces.com/contest/161/problem/D

## 算法思路与技巧总结

### 树形DP常见模式

#### 1. 基础树形DP
- **状态设计**: dp[u]表示以u为根的子树的相关信息
- **转移方式**: 自底向上，从叶子节点开始计算
- **典型题目**: 树的直径、最大路径和

#### 2. 换根DP
- **状态设计**: dp[u]表示以u为根时的全局信息
- **转移方式**: 第一次DFS计算子树信息，第二次DFS利用父节点信息更新子节点
- **典型题目**: 树中距离之和、最大代价树

#### 3. 树形背包DP
- **状态设计**: dp[u][j]表示以u为根的子树中选择j个节点的最优值
- **转移方式**: 类似01背包的合并方式
- **典型题目**: 选课问题、依赖选择问题

#### 4. 长链剖分优化
- **适用场景**: DP状态与深度相关的树形DP
- **优化原理**: 重儿子信息O(1)继承，轻儿子信息暴力合并
- **典型题目**: Dominant Indices、距离为k的点对

### 题型识别技巧

#### 看到以下特征考虑树形DP：
1. 问题涉及树结构
2. 需要计算子树相关信息
3. 最优解可以通过子问题组合得到
4. 问题具有重叠子问题和最优子结构

#### 看到以下特征考虑长链剖分：
1. DP状态与节点深度相关
2. 需要计算子树中到根节点距离为d的节点数
3. 数据规模较大（n ≥ 10^5）
4. 暴力解法时间复杂度为O(n²)

### 工程化考量

#### 1. 异常处理
- 空树或单节点树的边界情况
- 非法输入数据验证
- 内存溢出预防

#### 2. 性能优化
- 输入输出优化（BufferedReader/PrintWriter）
- 内存复用技术
- 递归深度控制

#### 3. 代码可维护性
- 统一的变量命名规范
- 详细的注释说明
- 模块化的函数设计

#### 4. 跨语言实现差异
- C++: 注重性能和内存控制
- Java: 注重代码安全和可读性
- Python: 注重代码简洁和开发效率

## 复杂度分析详解

### 时间复杂度分析

#### 基础树形DP
- 每个节点访问一次: O(n)
- 每个节点的子节点处理: O(deg(u))
- 总时间复杂度: ΣO(deg(u)) = O(n)

#### 长链剖分优化
- 重儿子继承: O(1)
- 轻儿子合并: 每条链只合并一次
- 总时间复杂度: O(n)

#### 树形背包DP
- 状态数: O(n×m)
- 每个状态转移: O(deg(u)×m)
- 总时间复杂度: O(n×m²)

### 空间复杂度分析

#### 基础树形DP
- 递归栈空间: O(h)
- DP数组: O(n)
- 总空间复杂度: O(n)

#### 长链剖分优化
- 内存复用: 同一条长链共享空间
- 总空间复杂度: O(n)

#### 树形背包DP
- DP数组: O(n×m)
- 总空间复杂度: O(n×m)

## 测试用例设计

### 边界测试用例
1. 空树
2. 单节点树
3. 链状树（退化为链表）
4. 完全二叉树
5. 星形树（一个中心节点连接多个叶子）

### 极端数据测试
1. 最大数据规模（n=10^6）
2. 深度极大的树
3. 节点值极端（极大/极小值）
4. 重复数据测试

## 多语言实现对比

### C++实现优势
- 性能最优，适合竞赛环境
- 内存控制精确
- 指针操作灵活

### Java实现优势
- 代码安全性高
- 垃圾回收自动管理内存
- 跨平台性好

### Python实现优势
- 代码简洁，开发效率高
- 适合算法验证和原型开发
- 丰富的标准库支持

通过系统学习这些题目和技巧，可以全面掌握树形DP和长链剖分的核心思想，提高算法设计和工程实现能力。